{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"platform\", \"children\"],\n    _excluded2 = [\"before\", \"className\", \"defaultValue\", \"placeholder\", \"after\", \"getRef\", \"platform\", \"icon\", \"onIconClick\", \"style\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from \"@vkontakte/icons\";\nimport { IOS, VKCOM, ANDROID } from \"../../lib/platform\";\nimport { Touch } from \"../Touch/Touch\";\nimport { noop } from \"../../lib/utils\";\nimport Text from \"../Typography/Text/Text\";\nimport Title from \"../Typography/Title/Title\";\nimport Headline from \"../Typography/Headline/Headline\";\nimport Separator from \"../Separator/Separator\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEnsuredControl } from \"../../hooks/useEnsuredControl\";\n\nvar SearchPlaceholderTypography = function SearchPlaceholderTypography(_ref) {\n  var platform = _ref.platform,\n      children = _ref.children,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  switch (platform) {\n    case IOS:\n      return createScopedElement(Title, _extends({}, restProps, {\n        level: \"3\",\n        weight: \"3\"\n      }), children);\n\n    case VKCOM:\n      return createScopedElement(Text, _extends({}, restProps, {\n        weight: \"regular\"\n      }), children);\n\n    case ANDROID:\n    default:\n      return createScopedElement(Headline, _extends({}, restProps, {\n        weight: \"regular\"\n      }), children);\n  }\n};\n\nvar Search = function Search(_ref2) {\n  var before = _ref2.before,\n      className = _ref2.className,\n      defaultValue = _ref2.defaultValue,\n      placeholder = _ref2.placeholder,\n      after = _ref2.after,\n      getRef = _ref2.getRef,\n      platform = _ref2.platform,\n      icon = _ref2.icon,\n      _ref2$onIconClick = _ref2.onIconClick,\n      onIconClick = _ref2$onIconClick === void 0 ? noop : _ref2$onIconClick,\n      style = _ref2.style,\n      inputProps = _objectWithoutProperties(_ref2, _excluded2);\n\n  var inputRef = useExternRef(getRef);\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isFocused = _React$useState2[0],\n      setFocused = _React$useState2[1];\n\n  var _useEnsuredControl = useEnsuredControl(inputProps, {\n    defaultValue: defaultValue\n  }),\n      _useEnsuredControl2 = _slicedToArray(_useEnsuredControl, 2),\n      value = _useEnsuredControl2[0],\n      onChange = _useEnsuredControl2[1];\n\n  var onFocus = function onFocus(e) {\n    setFocused(true);\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  var onBlur = function onBlur(e) {\n    setFocused(false);\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  var onCancel = React.useCallback(function () {\n    var _Object$getOwnPropert, _inputRef$current; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n\n    var nativeInputValueSetter = (_Object$getOwnPropert = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, \"value\")) === null || _Object$getOwnPropert === void 0 ? void 0 : _Object$getOwnPropert.set;\n    nativeInputValueSetter === null || nativeInputValueSetter === void 0 ? void 0 : nativeInputValueSetter.call(inputRef.current, \"\");\n    var ev2 = new Event(\"input\", {\n      bubbles: true\n    });\n    (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.dispatchEvent(ev2);\n  }, [inputRef]);\n  var onIconClickStart = React.useCallback(function (e) {\n    return onIconClick(e.originalEvent);\n  }, [onIconClick]);\n  var onIconCancelClickStart = React.useCallback(function (e) {\n    var _inputRef$current2;\n\n    e.originalEvent.preventDefault();\n    (_inputRef$current2 = inputRef.current) === null || _inputRef$current2 === void 0 ? void 0 : _inputRef$current2.focus();\n    onCancel();\n  }, [inputRef, onCancel]);\n  return createScopedElement(\"div\", {\n    vkuiClass: classNames(getClassName(\"Search\", platform), {\n      \"Search--focused\": isFocused,\n      \"Search--has-value\": !!value,\n      \"Search--has-after\": !!after,\n      \"Search--has-icon\": !!icon\n    }),\n    className: className,\n    style: style\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__in\"\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__width\"\n  }), createScopedElement(\"label\", {\n    vkuiClass: \"Search__control\"\n  }, createScopedElement(\"input\", _extends({\n    type: \"search\"\n  }, inputProps, {\n    ref: inputRef,\n    vkuiClass: \"Search__input\",\n    onFocus: onFocus,\n    onBlur: onBlur,\n    onChange: onChange,\n    value: value\n  })), platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-width\"\n  }, after), createScopedElement(\"div\", {\n    vkuiClass: \"Search__placeholder\"\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__placeholder-in\"\n  }, before, createScopedElement(SearchPlaceholderTypography, {\n    vkuiClass: \"Search__placeholder-text\",\n    platform: platform\n  }, placeholder)), isFocused && platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-width\"\n  }, after))), createScopedElement(\"div\", {\n    vkuiClass: \"Search__after\",\n    onClick: onCancel\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__icons\"\n  }, icon && createScopedElement(Touch, {\n    onStart: onIconClickStart,\n    vkuiClass: \"Search__icon\"\n  }, icon), !!value && createScopedElement(Touch, {\n    onStart: onIconCancelClickStart,\n    vkuiClass: \"Search__icon\"\n  }, platform === IOS ? createScopedElement(Icon16Clear, null) : createScopedElement(Icon24Cancel, null))), platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-in\"\n  }, after))), platform === VKCOM && createScopedElement(Separator, {\n    vkuiClass: \"Search__separator\",\n    wide: true\n  }));\n};\n\nSearch.defaultProps = {\n  autoComplete: \"off\",\n  defaultValue: \"\",\n  placeholder: \"Поиск\",\n  after: \"Отмена\",\n  before: createScopedElement(Icon16SearchOutline, null)\n}; // eslint-disable-next-line import/no-default-export\n\nexport default withPlatform(Search);","map":{"version":3,"mappings":"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","names":["React","classNames","withPlatform","getClassName","Icon16SearchOutline","Icon16Clear","Icon24Cancel","IOS","VKCOM","ANDROID","Touch","noop","Text","Title","Headline","Separator","useExternRef","useEnsuredControl","SearchPlaceholderTypography","platform","children","restProps","createScopedElement","level","weight","Search","before","className","defaultValue","placeholder","after","getRef","icon","onIconClick","style","inputProps","inputRef","useState","isFocused","setFocused","value","onChange","onFocus","e","onBlur","onCancel","useCallback","nativeInputValueSetter","Object","getOwnPropertyDescriptor","HTMLInputElement","prototype","_Object$getOwnPropert","set","call","current","ev2","Event","bubbles","dispatchEvent","onIconClickStart","originalEvent","onIconCancelClickStart","preventDefault","focus","vkuiClass","type","ref","onClick","onStart","wide","defaultProps","autoComplete"],"sources":["/Users/al.balandin/code/vkvideo-test/node_modules/@vkontakte/vkui/src/components/Search/Search.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport {\n  Icon16SearchOutline,\n  Icon16Clear,\n  Icon24Cancel,\n} from \"@vkontakte/icons\";\nimport { IOS, VKCOM, ANDROID } from \"../../lib/platform\";\nimport { HasPlatform, HasRef } from \"../../types\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { VKUITouchEvent } from \"../../lib/touch\";\nimport { noop } from \"../../lib/utils\";\nimport Text from \"../Typography/Text/Text\";\nimport Title from \"../Typography/Title/Title\";\nimport Headline from \"../Typography/Headline/Headline\";\nimport Separator from \"../Separator/Separator\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEnsuredControl } from \"../../hooks/useEnsuredControl\";\nimport \"./Search.css\";\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\ninterface SearchPlaceholderTypographyProps\n  extends HasPlatform,\n    React.HTMLAttributes<HTMLElement> {}\n\nconst SearchPlaceholderTypography: React.FC<\n  SearchPlaceholderTypographyProps\n> = ({ platform, children, ...restProps }) => {\n  switch (platform) {\n    case IOS:\n      return (\n        <Title {...restProps} level=\"3\" weight=\"3\">\n          {children}\n        </Title>\n      );\n    case VKCOM:\n      return (\n        <Text {...restProps} weight=\"regular\">\n          {children}\n        </Text>\n      );\n    case ANDROID:\n    default:\n      return (\n        <Headline {...restProps} weight=\"regular\">\n          {children}\n        </Headline>\n      );\n  }\n};\n\nexport interface SearchProps\n  extends React.InputHTMLAttributes<HTMLInputElement>,\n    HasRef<HTMLInputElement>,\n    HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: React.ReactNode;\n  before?: React.ReactNode;\n  icon?: React.ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\nconst Search: React.FC<SearchProps> = ({\n  before,\n  className,\n  defaultValue,\n  placeholder,\n  after,\n  getRef,\n  platform,\n  icon,\n  onIconClick = noop,\n  style,\n  ...inputProps\n}) => {\n  const inputRef = useExternRef(getRef);\n  const [isFocused, setFocused] = React.useState(false);\n  const [value, onChange] = useEnsuredControl(inputProps, { defaultValue });\n\n  const onFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocused(true);\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  const onBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocused(false);\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  const onCancel = React.useCallback(() => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(\n      HTMLInputElement.prototype,\n      \"value\"\n    )?.set;\n    nativeInputValueSetter?.call(inputRef.current, \"\");\n\n    const ev2 = new Event(\"input\", { bubbles: true });\n    inputRef.current?.dispatchEvent(ev2);\n  }, [inputRef]);\n\n  const onIconClickStart = React.useCallback(\n    (e: TouchEvent) => onIconClick(e.originalEvent),\n    [onIconClick]\n  );\n\n  const onIconCancelClickStart = React.useCallback(\n    (e: TouchEvent) => {\n      e.originalEvent.preventDefault();\n      inputRef.current?.focus();\n      onCancel();\n    },\n    [inputRef, onCancel]\n  );\n\n  return (\n    <div\n      vkuiClass={classNames(getClassName(\"Search\", platform), {\n        \"Search--focused\": isFocused,\n        \"Search--has-value\": !!value,\n        \"Search--has-after\": !!after,\n        \"Search--has-icon\": !!icon,\n      })}\n      className={className}\n      style={style}\n    >\n      <div vkuiClass=\"Search__in\">\n        <div vkuiClass=\"Search__width\" />\n        <label vkuiClass=\"Search__control\">\n          <input\n            type=\"search\"\n            {...inputProps}\n            ref={inputRef}\n            vkuiClass=\"Search__input\"\n            onFocus={onFocus}\n            onBlur={onBlur}\n            onChange={onChange}\n            value={value}\n          />\n          {platform === IOS && after && (\n            <div vkuiClass=\"Search__after-width\">{after}</div>\n          )}\n          <div vkuiClass=\"Search__placeholder\">\n            <div vkuiClass=\"Search__placeholder-in\">\n              {before}\n              <SearchPlaceholderTypography\n                vkuiClass=\"Search__placeholder-text\"\n                platform={platform}\n              >\n                {placeholder}\n              </SearchPlaceholderTypography>\n            </div>\n            {isFocused && platform === IOS && after && (\n              <div vkuiClass=\"Search__after-width\">{after}</div>\n            )}\n          </div>\n        </label>\n        <div vkuiClass=\"Search__after\" onClick={onCancel}>\n          <div vkuiClass=\"Search__icons\">\n            {icon && (\n              <Touch onStart={onIconClickStart} vkuiClass=\"Search__icon\">\n                {icon}\n              </Touch>\n            )}\n            {!!value && (\n              <Touch onStart={onIconCancelClickStart} vkuiClass=\"Search__icon\">\n                {platform === IOS ? <Icon16Clear /> : <Icon24Cancel />}\n              </Touch>\n            )}\n          </div>\n          {platform === IOS && after && (\n            <div vkuiClass=\"Search__after-in\">{after}</div>\n          )}\n        </div>\n      </div>\n      {platform === VKCOM && <Separator vkuiClass=\"Search__separator\" wide />}\n    </div>\n  );\n};\n\nSearch.defaultProps = {\n  autoComplete: \"off\",\n  defaultValue: \"\",\n  placeholder: \"Поиск\",\n  after: \"Отмена\",\n  before: <Icon16SearchOutline />,\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default withPlatform(Search);\n"]},"metadata":{},"sourceType":"module"}
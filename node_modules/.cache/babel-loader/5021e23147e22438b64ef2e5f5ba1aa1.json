{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"children\", \"className\", \"header\", \"text\", \"style\", \"iosCloseItem\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { ViewWidth, ViewHeight } from \"../../hoc/withAdaptivity\";\nimport { IOS } from \"../../lib/platform\";\nimport { ActionSheetDropdownDesktop } from \"./ActionSheetDropdownDesktop\";\nimport { ActionSheetDropdown } from \"./ActionSheetDropdown\";\nimport { hasReactNode, noop } from \"../../lib/utils\";\nimport { ActionSheetContext } from \"./ActionSheetContext\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nvar warn = warnOnce(\"ActionSheet\");\nexport var ActionSheet = function ActionSheet(_ref) {\n  var children = _ref.children,\n      className = _ref.className,\n      header = _ref.header,\n      text = _ref.text,\n      style = _ref.style,\n      iosCloseItem = _ref.iosCloseItem,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  var platform = usePlatform();\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      closing = _React$useState2[0],\n      setClosing = _React$useState2[1];\n\n  var onClose = function onClose() {\n    return setClosing(true);\n  };\n\n  var _action = React.useRef(noop);\n\n  var afterClose = function afterClose() {\n    var _restProps$onClose;\n\n    (_restProps$onClose = restProps.onClose) === null || _restProps$onClose === void 0 ? void 0 : _restProps$onClose.call(restProps);\n\n    _action.current();\n\n    _action.current = noop;\n  };\n\n  if (process.env.NODE_ENV === \"development\" && !restProps.onClose) {\n    warn(\"can't close on outer click without onClose\");\n  }\n\n  var _useAdaptivity = useAdaptivity(),\n      viewWidth = _useAdaptivity.viewWidth,\n      viewHeight = _useAdaptivity.viewHeight,\n      hasMouse = _useAdaptivity.hasMouse;\n\n  var isDesktop = viewWidth >= ViewWidth.SMALL_TABLET && (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n  var timeout = platform === IOS ? 300 : 200;\n\n  if (isDesktop) {\n    timeout = 0;\n  }\n\n  var fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(function () {\n    if (closing) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing, fallbackTransitionFinish]);\n  var onItemClick = React.useCallback(function (action, immediateAction, autoclose) {\n    return function (event) {\n      event.persist();\n      immediateAction && immediateAction(event);\n\n      if (autoclose) {\n        _action.current = function () {\n          return action && action(event);\n        };\n\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    };\n  }, []);\n  var contextValue = useObjectMemo({\n    onItemClick: onItemClick,\n    isDesktop: isDesktop\n  });\n  var DropdownComponent = isDesktop ? ActionSheetDropdownDesktop : ActionSheetDropdown;\n  var actionSheet = createScopedElement(ActionSheetContext.Provider, {\n    value: contextValue\n  }, createScopedElement(DropdownComponent, _extends({\n    closing: closing,\n    timeout: timeout\n  }, restProps, {\n    onClose: onClose,\n    className: isDesktop ? className : undefined,\n    style: isDesktop ? style : undefined\n  }), (hasReactNode(header) || hasReactNode(text)) && createScopedElement(\"header\", {\n    vkuiClass: \"ActionSheet__header\"\n  }, hasReactNode(header) && createScopedElement(Caption, {\n    weight: platform === IOS ? \"1\" : \"2\",\n    vkuiClass: \"ActionSheet__title\"\n  }, header), hasReactNode(text) && createScopedElement(Caption, {\n    vkuiClass: \"ActionSheet__text\"\n  }, text)), children, platform === IOS && !isDesktop && iosCloseItem));\n\n  if (isDesktop) {\n    return actionSheet;\n  }\n\n  return createScopedElement(PopoutWrapper, {\n    closing: closing,\n    alignY: \"bottom\",\n    className: className,\n    style: style,\n    onClick: onClose,\n    hasMask: true,\n    fixed: true\n  }, actionSheet);\n};\nActionSheet.defaultProps = {\n  popupDirection: \"bottom\"\n};","map":{"version":3,"mappings":";;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,aAAT;AACA,SAASC,SAAT,EAAoBC,UAApB;AACA,SAASC,GAAT;AACA,SAASC,0BAAT;AACA,SAASC,mBAAT;AACA,SAASC,YAAT,EAAuBC,IAAvB;AACA,SAASC,kBAAT;AACA,SAASC,OAAT;AACA,SAASC,WAAT;AACA,SAASC,UAAT;AACA,SAASC,aAAT;AACA,SAASC,aAAT;AACA,SAASC,QAAT;AA2BA,IAAMC,IAAI,GAAGD,QAAQ,CAAC,aAAD,CAArB;AAEA,OAAO,IAAME,WAAuC,GAAG,SAA1CA,WAA0C,OAQjD;EAAA,IAPJC,QAOI,QAPJA,QAOI;EAAA,IANJC,SAMI,QANJA,SAMI;EAAA,IALJC,MAKI,QALJA,MAKI;EAAA,IAJJC,IAII,QAJJA,IAII;EAAA,IAHJC,KAGI,QAHJA,KAGI;EAAA,IAFJC,YAEI,QAFJA,YAEI;EAAA,IADDC,SACC;;EACJ,IAAMC,QAAQ,GAAGd,WAAW,EAA5B;;EACA,sBAA8BX,KAAK,CAAC0B,QAAN1B,CAAe,KAAfA,CAA9B;EAAA;EAAA,IAAO2B,OAAP;EAAA,IAAgBC,UAAhB;;EACA,IAAMC,OAAO,GAAG,SAAVA,OAAU;IAAA,OAAMD,UAAU,CAAC,IAAD,CAAhB;EAAhB;;EACA,IAAME,OAAO,GAAG9B,KAAK,CAAC+B,MAAN/B,CAAaQ,IAAbR,CAAhB;;EAEA,IAAMgC,UAAU,GAAG,SAAbA,UAAa,GAAM;IAAA;;IACvB,+BAAS,CAACH,OAAV;;IACAC,OAAO,CAACG,OAARH;;IACAA,OAAO,CAACG,OAARH,GAAkBtB,IAAlBsB;EAHF;;EAMA,IAAII,OAAO,CAACC,GAARD,CAAYE,QAAZF,KAAyB,aAAzBA,IAA0C,CAACV,SAAS,CAACK,OAAzD,EAAkE;IAChEb,IAAI,CAAC,4CAAD,CAAJA;EACD;;EAED,qBAA4CH,aAAa,EAAzD;EAAA,IAAQwB,SAAR,kBAAQA,SAAR;EAAA,IAAmBC,UAAnB,kBAAmBA,UAAnB;EAAA,IAA+BC,QAA/B,kBAA+BA,QAA/B;;EACA,IAAMC,SAAS,GACbH,SAAS,IAAInC,SAAS,CAACuC,YAAvBJ,KACCE,QAAQ,IAAID,UAAU,IAAInC,UAAU,CAACuC,MADtCL,CADF;EAIA,IAAIM,OAAO,GAAGlB,QAAQ,KAAKrB,GAAbqB,GAAmB,GAAnBA,GAAyB,GAAvC;;EAEA,IAAIe,SAAJ,EAAe;IACbG,OAAO,GAAG,CAAVA;EACD;;EAED,IAAMC,wBAAwB,GAAGhC,UAAU,CAACoB,UAAD,EAAaW,OAAb,CAA3C;EACA3C,KAAK,CAAC6C,SAAN7C,CAAgB,YAAM;IACpB,IAAI2B,OAAJ,EAAa;MACXiB,wBAAwB,CAACE,GAAzBF;IADF,OAEO;MACLA,wBAAwB,CAACG,KAAzBH;IACD;EALH,GAMG,CAACjB,OAAD,EAAUiB,wBAAV,CANH5C;EAQA,IAAMgD,WAAW,GAAGhD,KAAK,CAACiD,WAANjD,CAClB,UAACkD,MAAD,EAASC,eAAT,EAA0BC,SAA1B;IAAA,OAAwC,UAACC,KAAD,EAAW;MACjDA,KAAK,CAACC,OAAND;MACAF,eAAe,IAAIA,eAAe,CAACE,KAAD,CAAlCF;;MACA,IAAIC,SAAJ,EAAe;QACbtB,OAAO,CAACG,OAARH,GAAkB;UAAA,OAAMoB,MAAM,IAAIA,MAAM,CAACG,KAAD,CAAtB;QAAlB;;QACAzB,UAAU,CAAC,IAAD,CAAVA;MAFF,OAGO;QACLsB,MAAM,IAAIA,MAAM,CAACG,KAAD,CAAhBH;MACD;IARH;EADkB,GAWlB,EAXkBlD,CAApB;EAaA,IAAMuD,YAAY,GAAGzC,aAAa,CAAC;IAAEkC,WAAW,EAAXA,WAAF;IAAeR,SAAS,EAATA;EAAf,CAAD,CAAlC;EAEA,IAAMgB,iBAAiB,GAAGhB,SAAS,GAC/BnC,0BAD+B,GAE/BC,mBAFJ;EAIA,IAAMmD,WAAW,GACfC,oBAACjD,kBAAD,CAAoBkD,QAApB;IAA6BC,KAAK,EAAEL;EAApC,GACEG,oBAACF,iBAAD;IACE7B,OAAO,EAAEA,OADX;IAEEgB,OAAO,EAAEA;EAFX,GAGOnB,SAHP;IAIEK,OAAO,EAAEA,OAJX;IAKEV,SAAS,EAAEqB,SAAS,GAAGrB,SAAH,GAAe0C,SALrC;IAMEvC,KAAK,EAAEkB,SAAS,GAAGlB,KAAH,GAAWuC;EAN7B,IAQG,CAACtD,YAAY,CAACa,MAAD,CAAZb,IAAwBA,YAAY,CAACc,IAAD,CAArC,KACCqC;IAAQI,SAAS,EAAC;EAAlB,GACGvD,YAAY,CAACa,MAAD,CAAZb,IACCmD,oBAAChD,OAAD;IACEqD,MAAM,EAAEtC,QAAQ,KAAKrB,GAAbqB,GAAmB,GAAnBA,GAAyB,GADnC;IAEEqC,SAAS,EAAC;EAFZ,GAIG1C,MAJH,CAFJ,EASGb,YAAY,CAACc,IAAD,CAAZd,IACCmD,oBAAChD,OAAD;IAASoD,SAAS,EAAC;EAAnB,GAAwCzC,IAAxC,CAVJ,CATJ,EAuBGH,QAvBH,EAwBGO,QAAQ,KAAKrB,GAAbqB,IAAoB,CAACe,SAArBf,IAAkCF,YAxBrC,CADF,CADF;;EA+BA,IAAIiB,SAAJ,EAAe;IACb,OAAOiB,WAAP;EACD;;EAED,OACEC,oBAACzD,aAAD;IACE0B,OAAO,EAAEA,OADX;IAEEqC,MAAM,EAAC,QAFT;IAGE7C,SAAS,EAAEA,SAHb;IAIEG,KAAK,EAAEA,KAJT;IAKE2C,OAAO,EAAEpC,OALX;IAMEqC,OAAO,MANT;IAOEC,KAAK;EAPP,GASGV,WATH,CADF;AAlGK;AAiHPxC,WAAW,CAACmD,YAAZnD,GAA2B;EACzBoD,cAAc,EAAE;AADS,CAA3BpD","names":["React","PopoutWrapper","ViewWidth","ViewHeight","IOS","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","noop","ActionSheetContext","Caption","usePlatform","useTimeout","useAdaptivity","useObjectMemo","warnOnce","warn","ActionSheet","children","className","header","text","style","iosCloseItem","restProps","platform","useState","closing","setClosing","onClose","_action","useRef","afterClose","current","process","env","NODE_ENV","viewWidth","viewHeight","hasMouse","isDesktop","SMALL_TABLET","MEDIUM","timeout","fallbackTransitionFinish","useEffect","set","clear","onItemClick","useCallback","action","immediateAction","autoclose","event","persist","contextValue","DropdownComponent","actionSheet","createScopedElement","Provider","value","undefined","vkuiClass","weight","alignY","onClick","hasMask","fixed","defaultProps","popupDirection"],"sources":["/Users/al.balandin/code/vkvideo-test/node_modules/@vkontakte/vkui/src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { ViewWidth, ViewHeight } from \"../../hoc/withAdaptivity\";\nimport { IOS } from \"../../lib/platform\";\nimport { ActionSheetDropdownDesktop } from \"./ActionSheetDropdownDesktop\";\nimport { ActionSheetDropdown } from \"./ActionSheetDropdown\";\nimport { hasReactNode, noop } from \"../../lib/utils\";\nimport { ActionSheetContext, ItemClickHandler } from \"./ActionSheetContext\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { SharedDropdownProps, PopupDirection, ToggleRef } from \"./types\";\nimport \"./ActionSheet.css\";\n\nexport interface ActionSheetProps extends React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи. В v5 будет обязательным.\n   */\n  onClose?: VoidFunction;\n  /**\n   * Элемент, рядом с которым вылезает попап на десктопе.\n   * Лучше передавать RefObject c current.\n   * В v5 будет обязательным.\n   */\n  toggleRef?: ToggleRef;\n  /**\n   * Направление на десктопе\n   */\n  popupDirection?: PopupDirection;\n  /**\n   * Только iOS. В v5 будет обязательным.\n   */\n  iosCloseItem?: React.ReactNode;\n}\n\nconst warn = warnOnce(\"ActionSheet\");\n\nexport const ActionSheet: React.FC<ActionSheetProps> = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  ...restProps\n}) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose?.();\n    _action.current();\n    _action.current = noop;\n  };\n\n  if (process.env.NODE_ENV === \"development\" && !restProps.onClose) {\n    warn(\"can't close on outer click without onClose\");\n  }\n\n  const { viewWidth, viewHeight, hasMouse } = useAdaptivity();\n  const isDesktop =\n    viewWidth >= ViewWidth.SMALL_TABLET &&\n    (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n\n  let timeout = platform === IOS ? 300 : 200;\n\n  if (isDesktop) {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closing) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    (action, immediateAction, autoclose) => (event) => {\n      event.persist();\n      immediateAction && immediateAction(event);\n      if (autoclose) {\n        _action.current = () => action && action(event);\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    },\n    []\n  );\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop\n    ? ActionSheetDropdownDesktop\n    : ActionSheetDropdown;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={closing}\n        timeout={timeout}\n        {...(restProps as Omit<SharedDropdownProps, \"closing\">)}\n        onClose={onClose}\n        className={isDesktop ? className : undefined}\n        style={isDesktop ? style : undefined}\n      >\n        {(hasReactNode(header) || hasReactNode(text)) && (\n          <header vkuiClass=\"ActionSheet__header\">\n            {hasReactNode(header) && (\n              <Caption\n                weight={platform === IOS ? \"1\" : \"2\"}\n                vkuiClass=\"ActionSheet__title\"\n              >\n                {header}\n              </Caption>\n            )}\n            {hasReactNode(text) && (\n              <Caption vkuiClass=\"ActionSheet__text\">{text}</Caption>\n            )}\n          </header>\n        )}\n        {children}\n        {platform === IOS && !isDesktop && iosCloseItem}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (isDesktop) {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n\nActionSheet.defaultProps = {\n  popupDirection: \"bottom\",\n};\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import { canUseDOM, canUseEventListeners } from './dom';\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\n\nexport function animate(_ref) {\n  var duration = _ref.duration,\n      timing = _ref.timing,\n      draw = _ref.draw;\n\n  if (!canUseDOM) {\n    return;\n  }\n\n  var start = window.performance.now();\n  window.requestAnimationFrame(function animate(time) {\n    var timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    var progress = timing(timeFraction);\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n} // WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\n\nexport var animationEvent = {\n  supported: false,\n  name: 'animationend'\n};\nexport var transitionEvent = {\n  supported: false,\n  name: 'transitionend'\n};\n\nif (canUseDOM) {\n  if (typeof AnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n  } else if (typeof WebKitAnimationEvent !== 'undefined') {\n    animationEvent.supported = true; // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n\n    animationEvent.name = 'webkitAnimationEnd';\n  }\n\n  if (typeof TransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n  } else if (typeof WebKitTransitionEvent !== 'undefined') {\n    transitionEvent.supported = true; // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n\n    transitionEvent.name = 'webkitTransitionEnd';\n  }\n}\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\n\n\nexport function waitAnimationEnd(listener, fallbackTime, el) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\n\nexport function cancelWaitAnimationEnd(listener, handle, el) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\n\nexport function waitTransitionEnd(el, listener, fallbackTime) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\n\nexport function cancelWaitTransitionEnd(listener, handle, el) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["canUseDOM","canUseEventListeners","animate","duration","timing","draw","start","window","performance","now","requestAnimationFrame","time","timeFraction","progress","animationEvent","supported","name","transitionEvent","AnimationEvent","WebKitAnimationEvent","TransitionEvent","WebKitTransitionEvent","waitAnimationEnd","listener","fallbackTime","el","addEventListener","setTimeout","cancelWaitAnimationEnd","handle","removeEventListener","clearTimeout","waitTransitionEnd","cancelWaitTransitionEnd"],"sources":["/Users/al.balandin/code/vkvideo-test/node_modules/@vkontakte/vkui/node_modules/@vkontakte/vkjs/src/animate.ts"],"sourcesContent":["import { canUseDOM, canUseEventListeners } from './dom';\nimport { SupportEvent } from './types';\n\ntype TimingInterface = (timeFraction: number) => number;\n\ntype DrawInterface = (progress: number) => void;\n\ninterface AnimateArgumentsInterface {\n  duration: number;\n  timing: TimingInterface;\n  draw: DrawInterface;\n}\n\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\nexport function animate({ duration, timing, draw }: AnimateArgumentsInterface) {\n  if (!canUseDOM) {\n    return;\n  }\n\n  const start = window.performance.now();\n\n  window.requestAnimationFrame(function animate(time) {\n    let timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    const progress = timing(timeFraction);\n\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n}\n\n// WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\ndeclare const WebKitAnimationEvent: AnimationEvent;\ndeclare const WebKitTransitionEvent: TransitionEvent;\n\nexport const animationEvent: SupportEvent<'animationend'> = {\n  supported: false,\n  name: 'animationend',\n};\n\nexport const transitionEvent: SupportEvent<'transitionend'> = {\n  supported: false,\n  name: 'transitionend',\n};\n\nif (canUseDOM) {\n  if (typeof AnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n  } else if (typeof WebKitAnimationEvent !== 'undefined') {\n    animationEvent.supported = true;\n\n    // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n    animationEvent.name = 'webkitAnimationEnd' as unknown as 'animationend';\n  }\n\n  if (typeof TransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n  } else if (typeof WebKitTransitionEvent !== 'undefined') {\n    transitionEvent.supported = true;\n\n    // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n    transitionEvent.name = 'webkitTransitionEnd' as unknown as 'transitionend';\n  }\n}\n\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitAnimationEnd(listener: (ev?: AnimationEvent) => any, fallbackTime: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\nexport function cancelWaitAnimationEnd(listener: (ev?: AnimationEvent) => any, handle?: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitTransitionEnd(el: GlobalEventHandlers, listener: (ev?: TransitionEvent) => any, fallbackTime: number) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\nexport function cancelWaitTransitionEnd(listener: (ev?: TransitionEvent) => any, handle?: number, el?: GlobalEventHandlers) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}
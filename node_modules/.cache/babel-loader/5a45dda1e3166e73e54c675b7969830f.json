{"ast":null,"code":"/**\n * @vkontakte/videoplayer-statistics v1.0.25\n * Wed, 21 Sep 2022 08:17:06 GMT\n * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-25/doc/\n */\nimport { ValueSubject as t, getExponentialDelay as e, Subscription as s, Subject as r, fromEvent as o } from '@vkontakte/videoplayer-shared/esnext.esm.js';\nimport i from 'lodash/debounce.js';\n\nconst a = (() => {\n  try {\n    const t = Date.now().toString(),\n          e = window.localStorage;\n    e.setItem(t, t);\n    const s = e.getItem(t) === t;\n    return e.removeItem(t), s ? e : null;\n  } catch (t) {\n    return null;\n  }\n})();\n\nvar n,\n    h,\n    u,\n    c,\n    p,\n    l,\n    d,\n    m = {\n  get: t => function (t) {\n    const e = a ? a.getItem('_one-stat_' + t) : null;\n    if (null === e) return null;\n\n    try {\n      return JSON.parse(e);\n    } catch (t) {\n      return null;\n    }\n  }(t) || null,\n\n  set(t, e) {\n    !function (t, e) {\n      try {\n        a && a.setItem('_one-stat_' + t, JSON.stringify(e));\n      } catch (t) {}\n    }(t, e);\n  },\n\n  remove(t) {\n    !function (t) {\n      a && a.removeItem('_one-stat_' + t);\n    }(t);\n  }\n\n};\n!function (t) {\n  t.PROD = 'prod', t.VK_ALIAS = 'vk_alias', t.VIDEOTEST = 'videotest', t.TEST = 'test', t.AUTO = 'auto';\n}(n || (n = {})), function (t) {\n  t.Q144P = '144', t.Q240P = '240', t.Q360P = '360', t.Q480P = '480', t.Q720P = '720', t.Q1080P = '1080', t.Q1440P = '1440', t.Q2160P = '2160', t.Q4320P = '4320', t.UNKNOWN = 'unknown';\n}(h || (h = {})), function (t) {\n  t.CHROMECAST = 'chromecast', t.APPLE_TV = 'appletv', t.PIP = 'pip', t.HEADPHONES = 'externalHeadphones', t.SCREEN = '';\n}(u || (u = {})), function (t) {\n  t.MP4 = 'mp4', t.DASH = 'dash', t.DASH_SEP = 'dash_sep', t.ONDEMAND_DASH = 'ondemand_dash', t.HLS = 'hls', t.ONDEMAND_HLS = 'ondemand_hls', t.WEBM = 'webm', t.RTMP = 'rtmp', t.UNKNOWN = 'unknown';\n}(c || (c = {})), function (t) {\n  t.AUTO = 'auto', t.MANUAL = '';\n}(p || (p = {})), function (t) {\n  t.HTTP1 = 'http1', t.HTTP2 = 'http2', t.HTTP3 = 'http3';\n}(l || (l = {})), function (t) {\n  t[t.YES = 1] = 'YES', t[t.NO = 0] = 'NO';\n}(d || (d = {}));\nconst g = {\n  [n.PROD]: 'https://api.ok.ru',\n  [n.VK_ALIAS]: 'https://api.mycdn.me',\n  [n.VIDEOTEST]: 'https://videotestapi.ok.ru/api',\n  [n.TEST]: 'https://apitest.ok.ru',\n  [n.AUTO]: ''\n},\n      f = {\n  start: 1e3,\n  factor: 1.5,\n  max: 3e5,\n  random: .1\n};\nvar y;\n!function (t) {\n  t[t.PARAM_SESSION_EXPIRED = 102] = 'PARAM_SESSION_EXPIRED', t[t.PARAM_SESSION_KEY = 103] = 'PARAM_SESSION_KEY', t[t.PARAM_SIGNATURE = 104] = 'PARAM_SIGNATURE', t[t.AUTH_LOGIN = 401] = 'AUTH_LOGIN';\n}(y || (y = {}));\n\nclass A {\n  params;\n  uuid;\n  authToken;\n  sessionKey;\n  authorizePromise;\n  refreshAuthTokenPromise;\n  consequentAuthErrors = 0;\n  authorized$ = new t(!1);\n  backoffTimeoutId;\n\n  constructor(t) {\n    this.params = t;\n    const e = m.get('uuid');\n    e ? this.uuid = String(e) : (this.uuid = function () {\n      const t = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),\n            e = new Array(36);\n      let s,\n          r,\n          o = 0;\n\n      for (r = 0; r < 36; r++) 8 === r || 13 === r || 18 === r || 23 === r ? e[r] = '-' : 14 === r ? e[r] = '4' : (o <= 2 && (o = 33554432 + 16777216 * Math.random() | 0), s = 15 & o, o >>= 4, e[r] = t[19 === r ? 3 & s | 8 : s]);\n\n      return e.join('');\n    }(), m.set('uuid', this.uuid));\n  }\n\n  async authorize(t) {\n    return this.authToken = t ?? (await this.refreshAuthToken()), this._authorizeWithBackoff();\n  }\n\n  logBeacon(t) {\n    const e = this.createLogParams(t),\n          s = this.sessionKey;\n    if (!s) return;\n    this.params.apiTransport.sendBeacon('log.externalLog', e, s) || this.logRequest(t);\n  }\n\n  async logRequest(t) {\n    var _this = this;\n\n    const e = 'log.externalLog',\n          s = this.createLogParams(t),\n          r = this.sessionKey ?? (await this._authorizeWithBackoff());\n    if (!r) return;\n\n    const o = async function (t) {\n      let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.params.requestRetryCount;\n\n      try {\n        return await _this.params.apiTransport.sendRequest(e, s, r);\n      } catch (s) {\n        if (!s || !('error_code' in s)) return void _this.params.error$.next({\n          id: 'logRequestUnknown',\n          message: `Unknown ${e} error`,\n          thrown: s\n        });\n        const r = s?.error_code;\n\n        switch (r) {\n          case y.PARAM_SESSION_EXPIRED:\n          case y.PARAM_SESSION_KEY:\n          case y.PARAM_SIGNATURE:\n            return _this.authorized$.next(!1), _this.sessionKey = await _this._authorizeWithBackoff(), i > 0 ? o(t, i - 1) : void 0;\n\n          case y.AUTH_LOGIN:\n            return _this.authorized$.next(!1), _this.authToken = await _this.refreshAuthToken(), _this.sessionKey = await _this._authorizeWithBackoff(), i > 0 ? o(t, i - 1) : void 0;\n\n          default:\n            return void _this.params.error$.next({\n              id: `LogRequest#${r}`,\n              message: `${e} error`,\n              data: s\n            });\n        }\n      }\n    };\n\n    return o(t);\n  }\n\n  destroy() {\n    window.clearTimeout(this.backoffTimeoutId), this.backoffTimeoutId = 0;\n  }\n\n  async refreshAuthToken() {\n    if (this.params.refreshAuthToken) return this.refreshAuthTokenPromise || (this.refreshAuthTokenPromise = this.params.refreshAuthToken().finally(() => {\n      this.refreshAuthTokenPromise = void 0;\n    })), this.refreshAuthTokenPromise;\n  }\n\n  createLogParams(t) {\n    return {\n      collector: 'ok.mobile.apps.video',\n      data: JSON.stringify({\n        application: '@vkontakte/videoplayer-statistics:1.0.25',\n        platform: 'WEB',\n        items: t.map(t => ({ ...t,\n          time: 0,\n          type: 1\n        }))\n      })\n    };\n  }\n\n  _authorizeWithBackoff() {\n    if (!this.consequentAuthErrors) return this._authorize();\n    const t = e(this.consequentAuthErrors, f);\n    return new Promise(e => {\n      this.backoffTimeoutId || (this.backoffTimeoutId = window.setTimeout(() => {\n        this._authorize().then(e).catch(t => this.params.error$.next({\n          id: 'AuthorizeBackoff',\n          message: 'Otherwise unhandle errror in authrization',\n          thrown: t\n        })).finally(() => this.backoffTimeoutId = 0);\n      }, t));\n    });\n  }\n\n  async _authorize() {\n    if (this.authorizePromise) return this.authorizePromise;\n    this.sessionKey = void 0, this.authorized$.next(!1);\n    const t = {\n      session_data: {\n        version: 2,\n        device_id: this.uuid,\n        client_version: '1.0.25'.split('-')[0],\n        client_type: 'SDK_JS'\n      }\n    };\n    return void 0 !== this.authToken && (t.session_data.auth_token = this.authToken, t.session_data.version = 3), this.authorizePromise = this.params.apiTransport.sendRequest('auth.anonymLogin', t).then(t => (t && t.session_key || this.params.error$.next({\n      id: 'AuthorizeFailed',\n      message: 'No session key',\n      data: t\n    }), this.sessionKey = t?.session_key ?? void 0, this.sessionKey)).catch(async t => {\n      this.sessionKey = void 0;\n      const e = t?.error_code;\n\n      switch (e) {\n        case y.AUTH_LOGIN:\n          return this.authToken = await this.refreshAuthToken(), this._authorizeWithBackoff();\n      }\n\n      e ? this.params.error$.next({\n        id: `Authorize#${e}`,\n        message: 'authorize error',\n        data: t\n      }) : this.params.error$.next({\n        id: 'AuthorizeUnknown',\n        message: 'authorize error',\n        thrown: t\n      });\n    }).finally(() => {\n      this.authorizePromise = void 0, this.consequentAuthErrors = this.sessionKey ? 0 : this.consequentAuthErrors + 1, this.authorized$.next(void 0 !== this.sessionKey);\n    }), this.authorizePromise;\n  }\n\n}\n\nfunction _(t) {\n  return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL ? (console.log('__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill'), !0) : 'function' == typeof t.Request && !t.Request.prototype.hasOwnProperty('signal') || !t.AbortController;\n}\n\nconst w = _({\n  fetch: window.fetch,\n  Request: window.Request,\n  AbortController: window.AbortController\n}),\n      T = w ? function (t) {\n  'function' == typeof t && (t = {\n    fetch: t\n  });\n  const {\n    fetch: e,\n    Request: s = e.Request,\n    AbortController: r,\n    __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL: o = !1\n  } = t;\n  if (!_({\n    fetch: e,\n    Request: s,\n    AbortController: r,\n    __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL: o\n  })) return {\n    fetch: e,\n    Request: i\n  };\n  let i = s;\n  (i && !i.prototype.hasOwnProperty('signal') || o) && (i = function (t, e) {\n    let r;\n    e && e.signal && (r = e.signal, delete e.signal);\n    const o = new s(t, e);\n    return r && Object.defineProperty(o, 'signal', {\n      writable: !1,\n      enumerable: !1,\n      configurable: !0,\n      value: r\n    }), o;\n  }, i.prototype = s.prototype);\n  const a = e;\n  return {\n    fetch: (t, e) => {\n      const s = i && i.prototype.isPrototypeOf(t) ? t.signal : e ? e.signal : void 0;\n\n      if (s) {\n        let r;\n\n        try {\n          r = new DOMException('Aborted', 'AbortError');\n        } catch (t) {\n          r = new Error('Aborted'), r.name = 'AbortError';\n        }\n\n        if (s.aborted) return Promise.reject(r);\n        const o = new Promise((t, e) => {\n          s.addEventListener('abort', () => e(r), {\n            once: !0\n          });\n        });\n        return e && e.signal && delete e.signal, Promise.race([o, a(t, e)]);\n      }\n\n      return a(t, e);\n    },\n    Request: i\n  };\n}({\n  fetch: window.fetch,\n  Request: window.Request,\n  AbortController: window.AbortController\n}) : void 0,\n      P = w ? T.fetch : window.fetch;\n\nw ? T.Request : window.Request;\n\nclass S {\n  apiKey;\n  apiBaseUrl;\n  apiEnv;\n  isApiBaseUrlFetched;\n  params;\n\n  constructor(t) {\n    this.params = t, this.apiKey = t.apiKey, this.apiEnv = t.apiEnv, this.apiBaseUrl = t.apiBaseUrl, this.isApiBaseUrlFetched = !1;\n  }\n\n  async resolveApiBaseUrl() {\n    if (this.apiEnv !== n.AUTO || this.isApiBaseUrlFetched) return this.apiBaseUrl;\n\n    try {\n      const t = atob('aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ='),\n            e = await P(t, {\n        method: 'GET',\n        mode: 'cors',\n        cache: 'no-cache'\n      }),\n            s = (await e.json())?.Answer[0]?.data;\n      if (!s) throw new Error('Wrong DNS response');\n      return s;\n    } catch (t) {\n      return this.params.error$.next({\n        id: 'OneStat:ApiTransport:resolveApiBaseUrl',\n        message: 'Unhandled resolve api base url error',\n        thrown: t\n      }), g[n.VK_ALIAS];\n    } finally {\n      this.isApiBaseUrlFetched = !0;\n    }\n  }\n\n  sendBeacon(t, e, s) {\n    if (!window.Blob || !window.navigator.sendBeacon) return !1;\n\n    const r = this._prepareQueryParams({\n      method: t,\n      queryParams: e,\n      sessionKey: s\n    }),\n          o = new window.Blob([r.toString()], {\n      type: 'application/x-www-form-urlencoded'\n    });\n\n    try {\n      return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`, o);\n    } catch (s) {\n      this.params.error$.next({\n        id: 'OneStat:ApiTransport:sendBeacon',\n        message: 'Unhandled beacon error',\n        thrown: s,\n        data: {\n          method: t,\n          params: e\n        }\n      });\n    }\n\n    return !1;\n  }\n\n  async sendRequest(t, e, s) {\n    const r = Date.now(),\n          o = o => {\n      o instanceof TypeError && ['Failed to fetch', 'NetworkError when attempting to fetch resource.'].includes(o.message) ? this.params.error$.next({\n        id: 'Network',\n        message: 'Request failed',\n        thrown: o\n      }) : this.params.error$.next({\n        id: 'OneStat:ApiTransport:sendRequest',\n        message: 'Unhandled request error',\n        thrown: o,\n        data: {\n          method: t,\n          params: e,\n          sessionKey: s,\n          time: Date.now() - r\n        }\n      });\n    };\n\n    return this.apiBaseUrl = await this.resolveApiBaseUrl(), P(`${this.apiBaseUrl}/fb.do`, {\n      method: 'post',\n      headers: {\n        'Content-type': 'application/x-www-form-urlencoded'\n      },\n      body: this._prepareQueryParams({\n        method: t,\n        queryParams: e,\n        sessionKey: s\n      })\n    }).then(t => Number(t.headers.get('content-length')) > 0 ? t.json().then(t => Object.prototype.hasOwnProperty.call(t, 'error_msg') ? Promise.reject(t) : t, o) : void 0, o);\n  }\n\n  _prepareQueryParams(t) {\n    const e = new URLSearchParams({\n      format: 'JSON',\n      method: t.method,\n      application_key: this.apiKey\n    });\n    return void 0 !== t.sessionKey && e.append('session_key', t.sessionKey), Object.entries(t.queryParams).forEach(_ref => {\n      let [t, s] = _ref;\n      return e.append(t, 'string' == typeof s ? s : JSON.stringify(s));\n    }), e;\n  }\n\n}\n\nclass E {\n  api;\n  error$;\n  requestQueue = [];\n  subscription;\n  isPaused = !1;\n  debouncedFlush = i(() => {\n    try {\n      this.flush();\n    } catch (t) {\n      this.error$.next({\n        id: 'LoggerError',\n        message: String(t) ?? 'Unknown logger error',\n        thrown: t\n      });\n    }\n  }, 3e3, {\n    maxWait: 15e3\n  });\n\n  constructor(t) {\n    this.api = t.api, this.error$ = t.error$, this.subscription = this.api.authorized$.subscribe(t => {\n      t && this.debouncedFlush();\n    });\n  }\n\n  log(t) {\n    this.requestQueue.push(t), this.isPaused || this.debouncedFlush();\n  }\n\n  flush() {\n    let t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;\n    0 !== this.requestQueue.length && (this.api.authorized$.getValue() ? (t ? this.api.logBeacon(this.requestQueue) : this.api.logRequest(this.requestQueue), this.requestQueue = []) : t || this.api.authorize(), this.debouncedFlush.cancel());\n  }\n\n  pause() {\n    this.isPaused = !0, this.debouncedFlush.cancel();\n  }\n\n  resume() {\n    this.isPaused = !1, this.debouncedFlush();\n  }\n\n  destroy() {\n    this.subscription.unsubscribe();\n  }\n\n}\n\nclass R {\n  api;\n  logger;\n  config;\n  subscription = new s();\n  experimental;\n  statContext;\n\n  constructor(t, e) {\n    this.statContext = t, this.config = { ...(e.config ?? {}),\n      requestRetryCount: 1\n    };\n    const s = new r();\n    this.experimental = {\n      error$: s\n    };\n    const i = new S({\n      apiKey: 'CIOPGQJGDIHBABABA',\n      apiBaseUrl: g[e.apiEnv],\n      apiEnv: e.apiEnv,\n      error$: s\n    });\n    this.api = new A({\n      apiTransport: i,\n      refreshAuthToken: e.refreshAuthToken,\n      requestRetryCount: this.config.requestRetryCount,\n      error$: s\n    }), this.logger = new E({\n      api: this.api,\n      error$: s\n    }), this.subscription.add(o(window, 'beforeunload').subscribe(() => this.logger.flush(!0)));\n  }\n\n  updateContext(t) {\n    this.statContext = { ...this.statContext,\n      ...t\n    };\n  }\n\n  authorize(t) {\n    return this.api.authorize(t);\n  }\n\n  pause() {\n    this.logger.pause();\n  }\n\n  resume() {\n    this.logger.resume();\n  }\n\n  destroy() {\n    this.logger.flush(), this.subscription.unsubscribe(), this.api.destroy(), this.logger.destroy();\n  }\n\n  logInited() {\n    this.log({\n      operation: 'init'\n    });\n  }\n\n  logReady(t) {\n    this.log({\n      operation: 'player_ready',\n      param: String(t.time)\n    });\n  }\n\n  logStarted(t) {\n    this.log({\n      operation: 'play',\n      param: String(Math.round(t.position))\n    });\n  }\n\n  logPlay() {\n    this.log({\n      operation: 'play_toggle'\n    });\n  }\n\n  logPause(t) {\n    this.log({\n      operation: 'pause',\n      param: String(Math.round(t.position))\n    });\n  }\n\n  logSeek() {\n    this.log({\n      operation: 'seek'\n    });\n  }\n\n  logFirstBytes(t) {\n    this.log({\n      operation: 'first_bytes',\n      param: String(t.time)\n    });\n  }\n\n  logFirstFrame(t) {\n    this.log({\n      operation: 'first_frame',\n      param: String(t.time)\n    });\n  }\n\n  logError(t) {\n    this.log({\n      operation: 'error',\n      param: t.errorType\n    });\n  }\n\n  logWatchCoverageRecord(t) {\n    this.log({\n      operation: 'watch_coverage_record',\n      param: `${t.start}-${t.end}`\n    }), this.logger.flush(!0);\n  }\n\n  logWatchCoverageLive(t) {\n    this.log({\n      operation: 'watch_coverage_live',\n      param: `${t.start}-${t.end}`\n    }), this.logger.flush(!0);\n  }\n\n  logEmptyBuffer(t) {\n    this.log({\n      operation: 'empty_buffer',\n      param: String(t.duration)\n    });\n  }\n\n  logDownloadSpeed(t) {\n    this.log({\n      operation: 'download_speed',\n      param: String(t.speed)\n    });\n  }\n\n  logAdSlotRequest() {\n    this.log({\n      operation: 'adv',\n      param: 'slot_request'\n    });\n  }\n\n  logAdStarted(t) {\n    this.log({\n      operation: 'adv',\n      param: t\n    });\n  }\n\n  logAdPaused() {\n    this.log({\n      operation: 'adv',\n      param: 'pause'\n    });\n  }\n\n  logAdResumed() {\n    this.log({\n      operation: 'adv',\n      param: 'resume'\n    });\n  }\n\n  logAdEnded() {\n    this.log({\n      operation: 'adv',\n      param: 'ended'\n    });\n  }\n\n  logAdSkipped() {\n    this.log({\n      operation: 'adv',\n      param: 'skip'\n    });\n  }\n\n  logAdClicked() {\n    this.log({\n      operation: 'adv',\n      param: 'click'\n    });\n  }\n\n  log(t) {\n    const e = this.crateLogItem(t);\n    this.logger.log(e);\n  }\n\n  crateLogItem(_ref2) {\n    let {\n      operation: t,\n      param: e\n    } = _ref2;\n    const s = Date.now(),\n          r = {\n      vid: this.statContext.movieId,\n      quality: this.statContext.quality,\n      dst: this.statContext.destination,\n      ct: this.statContext.contentType,\n      aid: this.statContext.albumId,\n      place: this.statContext.place,\n      cdn_host: this.statContext.cdnHostname,\n      connection_type: this.statContext.connectionType,\n      connection_reused: !0 === this.statContext.connectionReused ? d.YES : !1 === this.statContext.connectionReused ? d.NO : void 0,\n      stat_type: !0 === this.statContext.autoplay ? p.AUTO : !1 === this.statContext.autoplay ? p.MANUAL : void 0,\n      vk_playlist_id: this.statContext.vkPlaylistId,\n      vk_app_id: this.statContext.vkAppId,\n      track_code: this.statContext.trackCode\n    };\n    return void 0 !== e && (r.param = e), {\n      operation: t,\n      timestamp: s,\n      custom: r\n    };\n  }\n\n}\n\nexport { n as ApiEnv, l as ConnectionType, c as ContentType, R as OneStat, h as Quality, u as ScreenDestination };","map":{"version":3,"names":["ValueSubject","t","getExponentialDelay","e","Subscription","s","Subject","r","fromEvent","o","i","a","Date","now","toString","window","localStorage","setItem","getItem","removeItem","n","h","u","c","p","l","d","m","get","JSON","parse","set","stringify","remove","PROD","VK_ALIAS","VIDEOTEST","TEST","AUTO","Q144P","Q240P","Q360P","Q480P","Q720P","Q1080P","Q1440P","Q2160P","Q4320P","UNKNOWN","CHROMECAST","APPLE_TV","PIP","HEADPHONES","SCREEN","MP4","DASH","DASH_SEP","ONDEMAND_DASH","HLS","ONDEMAND_HLS","WEBM","RTMP","MANUAL","HTTP1","HTTP2","HTTP3","YES","NO","g","f","start","factor","max","random","y","PARAM_SESSION_EXPIRED","PARAM_SESSION_KEY","PARAM_SIGNATURE","AUTH_LOGIN","A","params","uuid","authToken","sessionKey","authorizePromise","refreshAuthTokenPromise","consequentAuthErrors","authorized$","backoffTimeoutId","constructor","String","split","Array","Math","join","authorize","refreshAuthToken","_authorizeWithBackoff","logBeacon","createLogParams","apiTransport","sendBeacon","logRequest","requestRetryCount","sendRequest","error$","next","id","message","thrown","error_code","data","destroy","clearTimeout","finally","collector","application","platform","items","map","time","type","_authorize","Promise","setTimeout","then","catch","session_data","version","device_id","client_version","client_type","auth_token","session_key","_","__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL","console","log","Request","prototype","hasOwnProperty","AbortController","w","fetch","T","signal","Object","defineProperty","writable","enumerable","configurable","value","isPrototypeOf","DOMException","Error","name","aborted","reject","addEventListener","once","race","P","S","apiKey","apiBaseUrl","apiEnv","isApiBaseUrlFetched","resolveApiBaseUrl","atob","method","mode","cache","json","Answer","Blob","navigator","_prepareQueryParams","queryParams","TypeError","includes","headers","body","Number","call","URLSearchParams","format","application_key","append","entries","forEach","E","api","requestQueue","subscription","isPaused","debouncedFlush","flush","maxWait","subscribe","push","length","getValue","cancel","pause","resume","unsubscribe","R","logger","config","experimental","statContext","add","updateContext","logInited","operation","logReady","param","logStarted","round","position","logPlay","logPause","logSeek","logFirstBytes","logFirstFrame","logError","errorType","logWatchCoverageRecord","end","logWatchCoverageLive","logEmptyBuffer","duration","logDownloadSpeed","speed","logAdSlotRequest","logAdStarted","logAdPaused","logAdResumed","logAdEnded","logAdSkipped","logAdClicked","crateLogItem","vid","movieId","quality","dst","destination","ct","contentType","aid","albumId","place","cdn_host","cdnHostname","connection_type","connectionType","connection_reused","connectionReused","stat_type","autoplay","vk_playlist_id","vkPlaylistId","vk_app_id","vkAppId","track_code","trackCode","timestamp","custom","ApiEnv","ConnectionType","ContentType","OneStat","Quality","ScreenDestination"],"sources":["/Users/al.balandin/code/vkvideo-test/node_modules/@vkontakte/videoplayer-statistics/esnext.esm.js"],"sourcesContent":["/**\n * @vkontakte/videoplayer-statistics v1.0.25\n * Wed, 21 Sep 2022 08:17:06 GMT\n * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-25/doc/\n */\nimport{ValueSubject as t,getExponentialDelay as e,Subscription as s,Subject as r,fromEvent as o}from'@vkontakte/videoplayer-shared/esnext.esm.js';import i from'lodash/debounce.js';const a=(()=>{try{const t=Date.now().toString(),e=window.localStorage;e.setItem(t,t);const s=e.getItem(t)===t;return e.removeItem(t),s?e:null}catch(t){return null}})();var n,h,u,c,p,l,d,m={get:t=>function(t){const e=a?a.getItem('_one-stat_'+t):null;if(null===e)return null;try{return JSON.parse(e)}catch(t){return null}}(t)||null,set(t,e){!function(t,e){try{a&&a.setItem('_one-stat_'+t,JSON.stringify(e))}catch(t){}}(t,e)},remove(t){!function(t){a&&a.removeItem('_one-stat_'+t)}(t)}};!function(t){t.PROD='prod',t.VK_ALIAS='vk_alias',t.VIDEOTEST='videotest',t.TEST='test',t.AUTO='auto'}(n||(n={})),function(t){t.Q144P='144',t.Q240P='240',t.Q360P='360',t.Q480P='480',t.Q720P='720',t.Q1080P='1080',t.Q1440P='1440',t.Q2160P='2160',t.Q4320P='4320',t.UNKNOWN='unknown'}(h||(h={})),function(t){t.CHROMECAST='chromecast',t.APPLE_TV='appletv',t.PIP='pip',t.HEADPHONES='externalHeadphones',t.SCREEN=''}(u||(u={})),function(t){t.MP4='mp4',t.DASH='dash',t.DASH_SEP='dash_sep',t.ONDEMAND_DASH='ondemand_dash',t.HLS='hls',t.ONDEMAND_HLS='ondemand_hls',t.WEBM='webm',t.RTMP='rtmp',t.UNKNOWN='unknown'}(c||(c={})),function(t){t.AUTO='auto',t.MANUAL=''}(p||(p={})),function(t){t.HTTP1='http1',t.HTTP2='http2',t.HTTP3='http3'}(l||(l={})),function(t){t[t.YES=1]='YES',t[t.NO=0]='NO'}(d||(d={}));const g={[n.PROD]:'https://api.ok.ru',[n.VK_ALIAS]:'https://api.mycdn.me',[n.VIDEOTEST]:'https://videotestapi.ok.ru/api',[n.TEST]:'https://apitest.ok.ru',[n.AUTO]:''},f={start:1e3,factor:1.5,max:3e5,random:.1};var y;!function(t){t[t.PARAM_SESSION_EXPIRED=102]='PARAM_SESSION_EXPIRED',t[t.PARAM_SESSION_KEY=103]='PARAM_SESSION_KEY',t[t.PARAM_SIGNATURE=104]='PARAM_SIGNATURE',t[t.AUTH_LOGIN=401]='AUTH_LOGIN'}(y||(y={}));class A{params;uuid;authToken;sessionKey;authorizePromise;refreshAuthTokenPromise;consequentAuthErrors=0;authorized$=new t(!1);backoffTimeoutId;constructor(t){this.params=t;const e=m.get('uuid');e?this.uuid=String(e):(this.uuid=function(){const t='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),e=new Array(36);let s,r,o=0;for(r=0;r<36;r++)8===r||13===r||18===r||23===r?e[r]='-':14===r?e[r]='4':(o<=2&&(o=33554432+16777216*Math.random()|0),s=15&o,o>>=4,e[r]=t[19===r?3&s|8:s]);return e.join('')}(),m.set('uuid',this.uuid))}async authorize(t){return this.authToken=t??await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(t){const e=this.createLogParams(t),s=this.sessionKey;if(!s)return;this.params.apiTransport.sendBeacon('log.externalLog',e,s)||this.logRequest(t)}async logRequest(t){const e='log.externalLog',s=this.createLogParams(t),r=this.sessionKey??await this._authorizeWithBackoff();if(!r)return;const o=async(t,i=this.params.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(e,s,r)}catch(s){if(!s||!('error_code'in s))return void this.params.error$.next({id:'logRequestUnknown',message:`Unknown ${e} error`,thrown:s});const r=s?.error_code;switch(r){case y.PARAM_SESSION_EXPIRED:case y.PARAM_SESSION_KEY:case y.PARAM_SIGNATURE:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),i>0?o(t,i-1):void 0;case y.AUTH_LOGIN:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),i>0?o(t,i-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${r}`,message:`${e} error`,data:s})}}};return o(t)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=this.params.refreshAuthToken().finally((()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(t){return{collector:'ok.mobile.apps.video',data:JSON.stringify({application:'@vkontakte/videoplayer-statistics:1.0.25',platform:'WEB',items:t.map((t=>({...t,time:0,type:1})))})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();const t=e(this.consequentAuthErrors,f);return new Promise((e=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{this._authorize().then(e).catch((t=>this.params.error$.next({id:'AuthorizeBackoff',message:'Otherwise unhandle errror in authrization',thrown:t}))).finally((()=>this.backoffTimeoutId=0))}),t))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);const t={session_data:{version:2,device_id:this.uuid,client_version:'1.0.25'.split('-')[0],client_type:'SDK_JS'}};return void 0!==this.authToken&&(t.session_data.auth_token=this.authToken,t.session_data.version=3),this.authorizePromise=this.params.apiTransport.sendRequest('auth.anonymLogin',t).then((t=>(t&&t.session_key||this.params.error$.next({id:'AuthorizeFailed',message:'No session key',data:t}),this.sessionKey=t?.session_key??void 0,this.sessionKey))).catch((async t=>{this.sessionKey=void 0;const e=t?.error_code;switch(e){case y.AUTH_LOGIN:return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff()}e?this.params.error$.next({id:`Authorize#${e}`,message:'authorize error',data:t}):this.params.error$.next({id:'AuthorizeUnknown',message:'authorize error',thrown:t})})).finally((()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}}function _(t){return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log('__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill'),!0):'function'==typeof t.Request&&!t.Request.prototype.hasOwnProperty('signal')||!t.AbortController}const w=_({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),T=w?function(t){'function'==typeof t&&(t={fetch:t});const{fetch:e,Request:s=e.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o=!1}=t;if(!_({fetch:e,Request:s,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:e,Request:i};let i=s;(i&&!i.prototype.hasOwnProperty('signal')||o)&&(i=function(t,e){let r;e&&e.signal&&(r=e.signal,delete e.signal);const o=new s(t,e);return r&&Object.defineProperty(o,'signal',{writable:!1,enumerable:!1,configurable:!0,value:r}),o},i.prototype=s.prototype);const a=e;return{fetch:(t,e)=>{const s=i&&i.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(s){let r;try{r=new DOMException('Aborted','AbortError')}catch(t){r=new Error('Aborted'),r.name='AbortError'}if(s.aborted)return Promise.reject(r);const o=new Promise(((t,e)=>{s.addEventListener('abort',(()=>e(r)),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([o,a(t,e)])}return a(t,e)},Request:i}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,P=w?T.fetch:window.fetch;w?T.Request:window.Request;class S{apiKey;apiBaseUrl;apiEnv;isApiBaseUrlFetched;params;constructor(t){this.params=t,this.apiKey=t.apiKey,this.apiEnv=t.apiEnv,this.apiBaseUrl=t.apiBaseUrl,this.isApiBaseUrlFetched=!1}async resolveApiBaseUrl(){if(this.apiEnv!==n.AUTO||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{const t=atob('aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ='),e=await P(t,{method:'GET',mode:'cors',cache:'no-cache'}),s=(await e.json())?.Answer[0]?.data;if(!s)throw new Error('Wrong DNS response');return s}catch(t){return this.params.error$.next({id:'OneStat:ApiTransport:resolveApiBaseUrl',message:'Unhandled resolve api base url error',thrown:t}),g[n.VK_ALIAS]}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(t,e,s){if(!window.Blob||!window.navigator.sendBeacon)return!1;const r=this._prepareQueryParams({method:t,queryParams:e,sessionKey:s}),o=new window.Blob([r.toString()],{type:'application/x-www-form-urlencoded'});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,o)}catch(s){this.params.error$.next({id:'OneStat:ApiTransport:sendBeacon',message:'Unhandled beacon error',thrown:s,data:{method:t,params:e}})}return!1}async sendRequest(t,e,s){const r=Date.now(),o=o=>{o instanceof TypeError&&['Failed to fetch','NetworkError when attempting to fetch resource.'].includes(o.message)?this.params.error$.next({id:'Network',message:'Request failed',thrown:o}):this.params.error$.next({id:'OneStat:ApiTransport:sendRequest',message:'Unhandled request error',thrown:o,data:{method:t,params:e,sessionKey:s,time:Date.now()-r}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),P(`${this.apiBaseUrl}/fb.do`,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:this._prepareQueryParams({method:t,queryParams:e,sessionKey:s})}).then((t=>Number(t.headers.get('content-length'))>0?t.json().then((t=>Object.prototype.hasOwnProperty.call(t,'error_msg')?Promise.reject(t):t),o):void 0),o)}_prepareQueryParams(t){const e=new URLSearchParams({format:'JSON',method:t.method,application_key:this.apiKey});return void 0!==t.sessionKey&&e.append('session_key',t.sessionKey),Object.entries(t.queryParams).forEach((([t,s])=>e.append(t,'string'==typeof s?s:JSON.stringify(s)))),e}}class E{api;error$;requestQueue=[];subscription;isPaused=!1;debouncedFlush=i((()=>{try{this.flush()}catch(t){this.error$.next({id:'LoggerError',message:String(t)??'Unknown logger error',thrown:t})}}),3e3,{maxWait:15e3});constructor(t){this.api=t.api,this.error$=t.error$,this.subscription=this.api.authorized$.subscribe((t=>{t&&this.debouncedFlush()}))}log(t){this.requestQueue.push(t),this.isPaused||this.debouncedFlush()}flush(t=!1){0!==this.requestQueue.length&&(this.api.authorized$.getValue()?(t?this.api.logBeacon(this.requestQueue):this.api.logRequest(this.requestQueue),this.requestQueue=[]):t||this.api.authorize(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe()}}class R{api;logger;config;subscription=new s;experimental;statContext;constructor(t,e){this.statContext=t,this.config={...e.config??{},requestRetryCount:1};const s=new r;this.experimental={error$:s};const i=new S({apiKey:'CIOPGQJGDIHBABABA',apiBaseUrl:g[e.apiEnv],apiEnv:e.apiEnv,error$:s});this.api=new A({apiTransport:i,refreshAuthToken:e.refreshAuthToken,requestRetryCount:this.config.requestRetryCount,error$:s}),this.logger=new E({api:this.api,error$:s}),this.subscription.add(o(window,'beforeunload').subscribe((()=>this.logger.flush(!0))))}updateContext(t){this.statContext={...this.statContext,...t}}authorize(t){return this.api.authorize(t)}pause(){this.logger.pause()}resume(){this.logger.resume()}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}logInited(){this.log({operation:'init'})}logReady(t){this.log({operation:'player_ready',param:String(t.time)})}logStarted(t){this.log({operation:'play',param:String(Math.round(t.position))})}logPlay(){this.log({operation:'play_toggle'})}logPause(t){this.log({operation:'pause',param:String(Math.round(t.position))})}logSeek(){this.log({operation:'seek'})}logFirstBytes(t){this.log({operation:'first_bytes',param:String(t.time)})}logFirstFrame(t){this.log({operation:'first_frame',param:String(t.time)})}logError(t){this.log({operation:'error',param:t.errorType})}logWatchCoverageRecord(t){this.log({operation:'watch_coverage_record',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logWatchCoverageLive(t){this.log({operation:'watch_coverage_live',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logEmptyBuffer(t){this.log({operation:'empty_buffer',param:String(t.duration)})}logDownloadSpeed(t){this.log({operation:'download_speed',param:String(t.speed)})}logAdSlotRequest(){this.log({operation:'adv',param:'slot_request'})}logAdStarted(t){this.log({operation:'adv',param:t})}logAdPaused(){this.log({operation:'adv',param:'pause'})}logAdResumed(){this.log({operation:'adv',param:'resume'})}logAdEnded(){this.log({operation:'adv',param:'ended'})}logAdSkipped(){this.log({operation:'adv',param:'skip'})}logAdClicked(){this.log({operation:'adv',param:'click'})}log(t){const e=this.crateLogItem(t);this.logger.log(e)}crateLogItem({operation:t,param:e}){const s=Date.now(),r={vid:this.statContext.movieId,quality:this.statContext.quality,dst:this.statContext.destination,ct:this.statContext.contentType,aid:this.statContext.albumId,place:this.statContext.place,cdn_host:this.statContext.cdnHostname,connection_type:this.statContext.connectionType,connection_reused:!0===this.statContext.connectionReused?d.YES:!1===this.statContext.connectionReused?d.NO:void 0,stat_type:!0===this.statContext.autoplay?p.AUTO:!1===this.statContext.autoplay?p.MANUAL:void 0,vk_playlist_id:this.statContext.vkPlaylistId,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode};return void 0!==e&&(r.param=e),{operation:t,timestamp:s,custom:r}}}export{n as ApiEnv,l as ConnectionType,c as ContentType,R as OneStat,h as Quality,u as ScreenDestination};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
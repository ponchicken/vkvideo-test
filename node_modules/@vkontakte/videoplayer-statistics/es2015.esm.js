/**
 * @vkontakte/videoplayer-statistics v1.0.25
 * Wed, 21 Sep 2022 08:17:06 GMT
 * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-25/doc/
 */
import{ValueSubject as t,getExponentialDelay as e,Subscription as r,Subject as n,fromEvent as o}from'@vkontakte/videoplayer-shared/es2015.esm.js';import i from'lodash/debounce.js';function s(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))}var a='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{},u=function(t){return t&&t.Math==Math&&t},c=u('object'==typeof globalThis&&globalThis)||u('object'==typeof window&&window)||u('object'==typeof self&&self)||u('object'==typeof a&&a)||function(){return this}()||Function('return this')(),h=function(t){try{return!!t()}catch(t){return!0}},f=!h((function(){var t=function(){}.bind();return'function'!=typeof t||t.hasOwnProperty('prototype')})),l=f,p=Function.prototype,d=p.apply,v=p.call,m='object'==typeof Reflect&&Reflect.apply||(l?v.bind(d):function(){return v.apply(d,arguments)}),y=f,g=Function.prototype,b=g.bind,w=g.call,T=y&&b.bind(w,w),_=y?function(t){return t&&T(t)}:function(t){return t&&function(){return w.apply(t,arguments)}},O=function(t){return'function'==typeof t},A={},S=!h((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),P=f,E=Function.prototype.call,R=P?E.bind(E):function(){return E.apply(E,arguments)},k={},j={}.propertyIsEnumerable,C=Object.getOwnPropertyDescriptor,x=C&&!j.call({1:2},1);k.f=x?function(t){var e=C(this,t);return!!e&&e.enumerable}:j;var I,N,L=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},U=_,q=U({}.toString),B=U(''.slice),z=function(t){return B(q(t),8,-1)},M=h,D=z,F=Object,$=_(''.split),K=M((function(){return!F('z').propertyIsEnumerable(0)}))?function(t){return'String'==D(t)?$(t,''):F(t)}:F,H=TypeError,Q=function(t){if(null==t)throw H('Can\'t call method on '+t);return t},W=K,G=Q,Y=O,J=function(t){return'object'==typeof t?null!==t:Y(t)},V={},Z=V,X=c,tt=O,et=function(t){return tt(t)?t:void 0},rt=function(t,e){return arguments.length<2?et(Z[t])||et(X[t]):Z[t]&&Z[t][e]||X[t]&&X[t][e]},nt=_({}.isPrototypeOf),ot=rt('navigator','userAgent')||'',it=c,st=ot,at=it.process,ut=it.Deno,ct=at&&at.versions||ut&&ut.version,ht=ct&&ct.v8;ht&&(N=(I=ht.split('.'))[0]>0&&I[0]<4?1:+(I[0]+I[1])),!N&&st&&(!(I=st.match(/Edge\/(\d+)/))||I[1]>=74)&&(I=st.match(/Chrome\/(\d+)/))&&(N=+I[1]);var ft=N,lt=ft,pt=h,dt=!!Object.getOwnPropertySymbols&&!pt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&lt&&lt<41})),vt=dt&&!Symbol.sham&&'symbol'==typeof Symbol.iterator,mt=rt,yt=O,gt=nt,bt=Object,wt=vt?function(t){return'symbol'==typeof t}:function(t){var e=mt('Symbol');return yt(e)&&gt(e.prototype,bt(t))},Tt=String,_t=function(t){try{return Tt(t)}catch(t){return'Object'}},Ot=O,At=_t,St=TypeError,Pt=function(t){if(Ot(t))return t;throw St(At(t)+' is not a function')},Et=Pt,Rt=function(t,e){var r=t[e];return null==r?void 0:Et(r)},kt=R,jt=O,Ct=J,xt=TypeError,It={exports:{}},Nt=c,Lt=Object.defineProperty,Ut=function(t,e){try{Lt(Nt,t,{value:e,configurable:!0,writable:!0})}catch(r){Nt[t]=e}return e},qt=c['__core-js_shared__']||Ut('__core-js_shared__',{}),Bt=qt;(It.exports=function(t,e){return Bt[t]||(Bt[t]=void 0!==e?e:{})})('versions',[]).push({version:'3.24.1',mode:'pure',copyright:'Â© 2014-2022 Denis Pushkarev (zloirock.ru)',license:'https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE',source:'https://github.com/zloirock/core-js'});var zt=Q,Mt=Object,Dt=function(t){return Mt(zt(t))},Ft=_({}.hasOwnProperty),$t=Object.hasOwn||function(t,e){return Ft(Dt(t),e)},Kt=_,Ht=0,Qt=Math.random(),Wt=Kt(1..toString),Gt=function(t){return'Symbol('+(void 0===t?'':t)+')_'+Wt(++Ht+Qt,36)},Yt=c,Jt=It.exports,Vt=$t,Zt=Gt,Xt=dt,te=vt,ee=Jt('wks'),re=Yt.Symbol,ne=re&&re.for,oe=te?re:re&&re.withoutSetter||Zt,ie=function(t){if(!Vt(ee,t)||!Xt&&'string'!=typeof ee[t]){var e='Symbol.'+t;Xt&&Vt(re,t)?ee[t]=re[t]:ee[t]=te&&ne?ne(e):oe(e)}return ee[t]},se=R,ae=J,ue=wt,ce=Rt,he=function(t,e){var r,n;if('string'===e&&jt(r=t.toString)&&!Ct(n=kt(r,t)))return n;if(jt(r=t.valueOf)&&!Ct(n=kt(r,t)))return n;if('string'!==e&&jt(r=t.toString)&&!Ct(n=kt(r,t)))return n;throw xt('Can\'t convert object to primitive value')},fe=TypeError,le=ie('toPrimitive'),pe=function(t,e){if(!ae(t)||ue(t))return t;var r,n=ce(t,le);if(n){if(void 0===e&&(e='default'),r=se(n,t,e),!ae(r)||ue(r))return r;throw fe('Can\'t convert object to primitive value')}return void 0===e&&(e='number'),he(t,e)},de=wt,ve=function(t){var e=pe(t,'string');return de(e)?e:e+''},me=J,ye=c.document,ge=me(ye)&&me(ye.createElement),be=function(t){return ge?ye.createElement(t):{}},we=be,Te=!S&&!h((function(){return 7!=Object.defineProperty(we('div'),'a',{get:function(){return 7}}).a})),_e=S,Oe=R,Ae=k,Se=L,Pe=function(t){return W(G(t))},Ee=ve,Re=$t,ke=Te,je=Object.getOwnPropertyDescriptor;A.f=_e?je:function(t,e){if(t=Pe(t),e=Ee(e),ke)try{return je(t,e)}catch(t){}if(Re(t,e))return Se(!Oe(Ae.f,t,e),t[e])};var Ce=h,xe=O,Ie=/#|\.prototype\./,Ne=function(t,e){var r=Ue[Le(t)];return r==Be||r!=qe&&(xe(e)?Ce(e):!!e)},Le=Ne.normalize=function(t){return String(t).replace(Ie,'.').toLowerCase()},Ue=Ne.data={},qe=Ne.NATIVE='N',Be=Ne.POLYFILL='P',ze=Ne,Me=Pt,De=f,Fe=_(_.bind),$e=function(t,e){return Me(t),void 0===e?t:De?Fe(t,e):function(){return t.apply(e,arguments)}},Ke={},He=S&&h((function(){return 42!=Object.defineProperty((function(){}),'prototype',{value:42,writable:!1}).prototype})),Qe=J,We=String,Ge=TypeError,Ye=function(t){if(Qe(t))return t;throw Ge(We(t)+' is not an object')},Je=S,Ve=Te,Ze=He,Xe=Ye,tr=ve,er=TypeError,rr=Object.defineProperty,nr=Object.getOwnPropertyDescriptor;Ke.f=Je?Ze?function(t,e,r){if(Xe(t),e=tr(e),Xe(r),'function'==typeof t&&'prototype'===e&&'value'in r&&'writable'in r&&!r.writable){var n=nr(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:'configurable'in r?r.configurable:n.configurable,enumerable:'enumerable'in r?r.enumerable:n.enumerable,writable:!1})}return rr(t,e,r)}:rr:function(t,e,r){if(Xe(t),e=tr(e),Xe(r),Ve)try{return rr(t,e,r)}catch(t){}if('get'in r||'set'in r)throw er('Accessors not supported');return'value'in r&&(t[e]=r.value),t};var or=Ke,ir=L,sr=S?function(t,e,r){return or.f(t,e,ir(1,r))}:function(t,e,r){return t[e]=r,t},ar=c,ur=m,cr=_,hr=O,fr=A.f,lr=ze,pr=V,dr=$e,vr=sr,mr=$t,yr=function(t){var e=function(r,n,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,n)}return new t(r,n,o)}return ur(t,this,arguments)};return e.prototype=t.prototype,e},gr=function(t,e){var r,n,o,i,s,a,u,c,h=t.target,f=t.global,l=t.stat,p=t.proto,d=f?ar:l?ar[h]:(ar[h]||{}).prototype,v=f?pr:pr[h]||vr(pr,h,{})[h],m=v.prototype;for(o in e)r=!lr(f?o:h+(l?'.':'#')+o,t.forced)&&d&&mr(d,o),s=v[o],r&&(a=t.dontCallGetSet?(c=fr(d,o))&&c.value:d[o]),i=r&&a?a:e[o],r&&typeof s==typeof i||(u=t.bind&&r?dr(i,ar):t.wrap&&r?yr(i):p&&hr(i)?cr(i):i,(t.sham||i&&i.sham||s&&s.sham)&&vr(u,'sham',!0),vr(v,o,u),p&&(mr(pr,n=h+'Prototype')||vr(pr,n,{}),vr(pr[n],o,i),t.real&&m&&!m[o]&&vr(m,o,i)))},br='process'==z(c.process),wr=sr,Tr=(TypeError,_);Object.setPrototypeOf||'__proto__'in{}&&function(){var t,e=!1,r={};try{(t=Tr(Object.getOwnPropertyDescriptor(Object.prototype,'__proto__').set))(r,[]),e=r instanceof Array}catch(t){}}();var _r={};_r[ie('toStringTag')]='z';var Or='[object z]'===String(_r),Ar=Or,Sr=O,Pr=z,Er=ie('toStringTag'),Rr=Object,kr='Arguments'==Pr(function(){return arguments}()),jr=Ar?Pr:function(t){var e,r,n;return void 0===t?'Undefined':null===t?'Null':'string'==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Rr(t),Er))?r:kr?Pr(e):'Object'==(n=Pr(e))&&Sr(e.callee)?'Arguments':n},Cr=jr,xr=Or?{}.toString:function(){return'[object '+Cr(this)+']'},Ir=Or,Nr=Ke.f,Lr=sr,Ur=$t,qr=xr,Br=ie('toStringTag'),zr=rt,Mr=Ke,Dr=S,Fr=ie('species'),$r=nt,Kr=TypeError,Hr=O,Qr=qt,Wr=_(Function.toString);Hr(Qr.inspectSource)||(Qr.inspectSource=function(t){return Wr(t)});var Gr=Qr.inspectSource,Yr=_,Jr=h,Vr=O,Zr=jr,Xr=Gr,tn=function(){},en=[],rn=rt('Reflect','construct'),nn=/^\s*(?:class|function)\b/,on=Yr(nn.exec),sn=!nn.exec(tn),an=function(t){if(!Vr(t))return!1;try{return rn(tn,en,t),!0}catch(t){return!1}},un=function(t){if(!Vr(t))return!1;switch(Zr(t)){case'AsyncFunction':case'GeneratorFunction':case'AsyncGeneratorFunction':return!1}try{return sn||!!on(nn,Xr(t))}catch(t){return!0}};un.sham=!0;var cn,hn,fn,ln,pn=!rn||Jr((function(){var t;return an(an.call)||!an(Object)||!an((function(){t=!0}))||t}))?un:an,dn=_t,vn=TypeError,mn=Ye,yn=function(t){if(pn(t))return t;throw vn(dn(t)+' is not a constructor')},gn=ie('species'),bn=function(t,e){var r,n=mn(t).constructor;return void 0===n||null==(r=mn(n)[gn])?e:yn(r)},wn=rt('document','documentElement'),Tn=_([].slice),_n=TypeError,On=/(?:ipad|iphone|ipod).*applewebkit/i.test(ot),An=c,Sn=m,Pn=$e,En=O,Rn=$t,kn=h,jn=wn,Cn=Tn,xn=be,In=function(t,e){if(t<e)throw _n('Not enough arguments');return t},Nn=On,Ln=br,Un=An.setImmediate,qn=An.clearImmediate,Bn=An.process,zn=An.Dispatch,Mn=An.Function,Dn=An.MessageChannel,Fn=An.String,$n=0,Kn={};try{cn=An.location}catch(t){}var Hn=function(t){if(Rn(Kn,t)){var e=Kn[t];delete Kn[t],e()}},Qn=function(t){return function(){Hn(t)}},Wn=function(t){Hn(t.data)},Gn=function(t){An.postMessage(Fn(t),cn.protocol+'//'+cn.host)};Un&&qn||(Un=function(t){In(arguments.length,1);var e=En(t)?t:Mn(t),r=Cn(arguments,1);return Kn[++$n]=function(){Sn(e,void 0,r)},hn($n),$n},qn=function(t){delete Kn[t]},Ln?hn=function(t){Bn.nextTick(Qn(t))}:zn&&zn.now?hn=function(t){zn.now(Qn(t))}:Dn&&!Nn?(ln=(fn=new Dn).port2,fn.port1.onmessage=Wn,hn=Pn(ln.postMessage,ln)):An.addEventListener&&En(An.postMessage)&&!An.importScripts&&cn&&'file:'!==cn.protocol&&!kn(Gn)?(hn=Gn,An.addEventListener('message',Wn,!1)):hn='onreadystatechange'in xn('script')?function(t){jn.appendChild(xn('script')).onreadystatechange=function(){jn.removeChild(this),Hn(t)}}:function(t){setTimeout(Qn(t),0)});var Yn,Jn,Vn,Zn,Xn,to,eo,ro,no={set:Un,clear:qn},oo=c,io=/ipad|iphone|ipod/i.test(ot)&&void 0!==oo.Pebble,so=/web0s(?!.*chrome)/i.test(ot),ao=c,uo=$e,co=A.f,ho=no.set,fo=On,lo=io,po=so,vo=br,mo=ao.MutationObserver||ao.WebKitMutationObserver,yo=ao.document,go=ao.process,bo=ao.Promise,wo=co(ao,'queueMicrotask'),To=wo&&wo.value;To||(Yn=function(){var t,e;for(vo&&(t=go.domain)&&t.exit();Jn;){e=Jn.fn,Jn=Jn.next;try{e()}catch(t){throw Jn?Zn():Vn=void 0,t}}Vn=void 0,t&&t.enter()},fo||vo||po||!mo||!yo?!lo&&bo&&bo.resolve?((eo=bo.resolve(void 0)).constructor=bo,ro=uo(eo.then,eo),Zn=function(){ro(Yn)}):vo?Zn=function(){go.nextTick(Yn)}:(ho=uo(ho,ao),Zn=function(){ho(Yn)}):(Xn=!0,to=yo.createTextNode(''),new mo(Yn).observe(to,{characterData:!0}),Zn=function(){to.data=Xn=!Xn}));var _o=To||function(t){var e={fn:t,next:void 0};Vn&&(Vn.next=e),Jn||(Jn=e,Zn()),Vn=e},Oo=c,Ao=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},So=function(){this.head=null,this.tail=null};So.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Po,Eo,Ro,ko=So,jo=O,Co=Gr,xo=c.WeakMap,Io=jo(xo)&&/native code/.test(Co(xo)),No=It.exports,Lo=Gt,Uo=No('keys'),qo=Io,Bo=c,zo=_,Mo=J,Do=sr,Fo=$t,$o=qt,Ko=function(t){return Uo[t]||(Uo[t]=Lo(t))},Ho=Bo.TypeError,Qo=Bo.WeakMap;if(qo||$o.state){var Wo=$o.state||($o.state=new Qo),Go=zo(Wo.get),Yo=zo(Wo.has),Jo=zo(Wo.set);Po=function(t,e){if(Yo(Wo,t))throw new Ho('Object already initialized');return e.facade=t,Jo(Wo,t,e),e},Eo=function(t){return Go(Wo,t)||{}},Ro=function(t){return Yo(Wo,t)}}else{var Vo=Ko('state');Po=function(t,e){if(Fo(t,Vo))throw new Ho('Object already initialized');return e.facade=t,Do(t,Vo,e),e},Eo=function(t){return Fo(t,Vo)?t[Vo]:{}},Ro=function(t){return Fo(t,Vo)}}var Zo={set:Po,get:Eo,has:Ro,enforce:function(t){return Ro(t)?Eo(t):Po(t,{})},getterFor:function(t){return function(e){var r;if(!Mo(e)||(r=Eo(e)).type!==t)throw Ho('Incompatible receiver, '+t+' required');return r}}},Xo=c.Promise,ti='object'==typeof Deno&&Deno&&'object'==typeof Deno.version,ei=!ti&&!br&&'object'==typeof window&&'object'==typeof document,ri=c,ni=Xo,oi=O,ii=ze,si=Gr,ai=ie,ui=ei,ci=ti,hi=ft,fi=ni&&ni.prototype,li=ai('species'),pi=!1,di=oi(ri.PromiseRejectionEvent),vi={CONSTRUCTOR:ii('Promise',(function(){var t=si(ni),e=t!==String(ni);if(!e&&66===hi)return!0;if(!fi.catch||!fi.finally)return!0;if(!hi||hi<51||!/native code/.test(t)){var r=new ni((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[li]=n,!(pi=r.then((function(){}))instanceof n))return!0}return!e&&(ui||ci)&&!di})),REJECTION_EVENT:di,SUBCLASSING:pi},mi={},yi=Pt,gi=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw TypeError('Bad Promise constructor');e=t,r=n})),this.resolve=yi(e),this.reject=yi(r)};mi.f=function(t){return new gi(t)};var bi,wi,Ti=gr,_i=br,Oi=c,Ai=R,Si=function(t,e,r,n){return n&&n.enumerable?t[e]=r:wr(t,e,r),t},Pi=function(t,e,r,n){if(t){var o=r?t:t.prototype;Ur(o,Br)||Nr(o,Br,{configurable:!0,value:e}),n&&!Ir&&Lr(o,'toString',qr)}},Ei=function(t){var e=zr(t),r=Mr.f;Dr&&e&&!e[Fr]&&r(e,Fr,{configurable:!0,get:function(){return this}})},Ri=Pt,ki=O,ji=J,Ci=function(t,e){if($r(e,t))return t;throw Kr('Incorrect invocation')},xi=bn,Ii=no.set,Ni=_o,Li=function(t,e){var r=Oo.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))},Ui=Ao,qi=ko,Bi=Zo,zi=Xo,Mi=mi,Di=vi.CONSTRUCTOR,Fi=vi.REJECTION_EVENT,$i=Bi.getterFor('Promise'),Ki=Bi.set,Hi=zi&&zi.prototype,Qi=zi,Wi=Hi,Gi=Oi.TypeError,Yi=Oi.document,Ji=Oi.process,Vi=Mi.f,Zi=Vi,Xi=!!(Yi&&Yi.createEvent&&Oi.dispatchEvent),ts=function(t){var e;return!(!ji(t)||!ki(e=t.then))&&e},es=function(t,e){var r,n,o,i=e.value,s=1==e.state,a=s?t.ok:t.fail,u=t.resolve,c=t.reject,h=t.domain;try{a?(s||(2===e.rejection&&ss(e),e.rejection=1),!0===a?r=i:(h&&h.enter(),r=a(i),h&&(h.exit(),o=!0)),r===t.promise?c(Gi('Promise-chain cycle')):(n=ts(r))?Ai(n,r,u,c):u(r)):c(i)}catch(t){h&&!o&&h.exit(),c(t)}},rs=function(t,e){t.notified||(t.notified=!0,Ni((function(){for(var r,n=t.reactions;r=n.get();)es(r,t);t.notified=!1,e&&!t.rejection&&os(t)})))},ns=function(t,e,r){var n,o;Xi?((n=Yi.createEvent('Event')).promise=e,n.reason=r,n.initEvent(t,!1,!0),Oi.dispatchEvent(n)):n={promise:e,reason:r},!Fi&&(o=Oi['on'+t])?o(n):'unhandledrejection'===t&&Li('Unhandled promise rejection',r)},os=function(t){Ai(Ii,Oi,(function(){var e,r=t.facade,n=t.value;if(is(t)&&(e=Ui((function(){_i?Ji.emit('unhandledRejection',n,r):ns('unhandledrejection',r,n)})),t.rejection=_i||is(t)?2:1,e.error))throw e.value}))},is=function(t){return 1!==t.rejection&&!t.parent},ss=function(t){Ai(Ii,Oi,(function(){var e=t.facade;_i?Ji.emit('rejectionHandled',e):ns('rejectionhandled',e,t.value)}))},as=function(t,e,r){return function(n){t(e,n,r)}},us=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,rs(t,!0))},cs=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Gi('Promise can\'t be resolved itself');var n=ts(e);n?Ni((function(){var r={done:!1};try{Ai(n,e,as(cs,r,t),as(us,r,t))}catch(e){us(r,e,t)}})):(t.value=e,t.state=1,rs(t,!1))}catch(e){us({done:!1},e,t)}}};Di&&(Wi=(Qi=function(t){Ci(this,Wi),Ri(t),Ai(bi,this);var e=$i(this);try{t(as(cs,e),as(us,e))}catch(t){us(e,t)}}).prototype,(bi=function(t){Ki(this,{type:'Promise',done:!1,notified:!1,parent:!1,reactions:new qi,rejection:!1,state:0,value:void 0})}).prototype=Si(Wi,'then',(function(t,e){var r=$i(this),n=Vi(xi(this,Qi));return r.parent=!0,n.ok=!ki(t)||t,n.fail=ki(e)&&e,n.domain=_i?Ji.domain:void 0,0==r.state?r.reactions.add(n):Ni((function(){es(n,r)})),n.promise})),wi=function(){var t=new bi,e=$i(t);this.promise=t,this.resolve=as(cs,e),this.reject=as(us,e)},Mi.f=Vi=function(t){return t===Qi||undefined===t?new wi(t):Zi(t)}),Ti({global:!0,constructor:!0,wrap:!0,forced:Di},{Promise:Qi}),Pi(Qi,'Promise',!1,!0),Ei('Promise');var hs={},fs=hs,ls=ie('iterator'),ps=Array.prototype,ds=Math.ceil,vs=Math.floor,ms=Math.trunc||function(t){var e=+t;return(e>0?vs:ds)(e)},ys=function(t){var e=+t;return e!=e||0===e?0:ms(e)},gs=Math.min,bs=function(t){return t>0?gs(ys(t),9007199254740991):0},ws=jr,Ts=Rt,_s=hs,Os=ie('iterator'),As=function(t){if(null!=t)return Ts(t,Os)||Ts(t,'@@iterator')||_s[ws(t)]},Ss=R,Ps=Pt,Es=Ye,Rs=_t,ks=As,js=TypeError,Cs=R,xs=Ye,Is=Rt,Ns=$e,Ls=R,Us=Ye,qs=_t,Bs=function(t){return void 0!==t&&(fs.Array===t||ps[ls]===t)},zs=function(t){return bs(t.length)},Ms=nt,Ds=function(t,e){var r=arguments.length<2?ks(t):e;if(Ps(r))return Es(Ss(r,t));throw js(Rs(t)+' is not iterable')},Fs=As,$s=function(t,e,r){var n,o;xs(t);try{if(!(n=Is(t,'return'))){if('throw'===e)throw r;return r}n=Cs(n,t)}catch(t){o=!0,n=t}if('throw'===e)throw r;if(o)throw n;return xs(n),r},Ks=TypeError,Hs=function(t,e){this.stopped=t,this.result=e},Qs=Hs.prototype,Ws=function(t,e,r){var n,o,i,s,a,u,c,h=r&&r.that,f=!(!r||!r.AS_ENTRIES),l=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),d=!(!r||!r.INTERRUPTED),v=Ns(e,h),m=function(t){return n&&$s(n,'normal',t),new Hs(!0,t)},y=function(t){return f?(Us(t),d?v(t[0],t[1],m):v(t[0],t[1])):d?v(t,m):v(t)};if(l)n=t.iterator;else if(p)n=t;else{if(!(o=Fs(t)))throw Ks(qs(t)+' is not iterable');if(Bs(o)){for(i=0,s=zs(t);s>i;i++)if((a=y(t[i]))&&Ms(Qs,a))return a;return new Hs(!1)}n=Ds(t,o)}for(u=l?t.next:n.next;!(c=Ls(u,n)).done;){try{a=y(c.value)}catch(t){$s(n,'throw',t)}if('object'==typeof a&&a&&Ms(Qs,a))return a}return new Hs(!1)},Gs=ie('iterator'),Ys=!1;try{var Js=0,Vs={next:function(){return{done:!!Js++}},return:function(){Ys=!0}};Vs[Gs]=function(){return this},Array.from(Vs,(function(){throw 2}))}catch(t){}var Zs=Xo,Xs=vi.CONSTRUCTOR||!function(t,e){if(!e&&!Ys)return!1;var r=!1;try{var n={};n[Gs]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r}((function(t){Zs.all(t).then(void 0,(function(){}))})),ta=R,ea=Pt,ra=mi,na=Ao,oa=Ws;gr({target:'Promise',stat:!0,forced:Xs},{all:function(t){var e=this,r=ra.f(e),n=r.resolve,o=r.reject,i=na((function(){var r=ea(e.resolve),i=[],s=0,a=1;oa(t,(function(t){var u=s++,c=!1;a++,ta(r,e,t).then((function(t){c||(c=!0,i[u]=t,--a||n(i))}),o)})),--a||n(i)}));return i.error&&o(i.value),r.promise}});var ia=gr,sa=vi.CONSTRUCTOR;Xo&&Xo.prototype,ia({target:'Promise',proto:!0,forced:sa,real:!0},{catch:function(t){return this.then(void 0,t)}});var aa=R,ua=Pt,ca=mi,ha=Ao,fa=Ws;gr({target:'Promise',stat:!0,forced:Xs},{race:function(t){var e=this,r=ca.f(e),n=r.reject,o=ha((function(){var o=ua(e.resolve);fa(t,(function(t){aa(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}});var la=R,pa=mi;gr({target:'Promise',stat:!0,forced:vi.CONSTRUCTOR},{reject:function(t){var e=pa.f(this);return la(e.reject,void 0,t),e.promise}});var da=Ye,va=J,ma=mi,ya=function(t,e){if(da(t),va(e)&&e.constructor===t)return e;var r=ma.f(t);return(0,r.resolve)(e),r.promise},ga=gr,ba=Xo,wa=vi.CONSTRUCTOR,Ta=ya,_a=rt('Promise'),Oa=!wa;ga({target:'Promise',stat:!0,forced:true},{resolve:function(t){return Ta(Oa&&this===_a?ba:this,t)}});var Aa=gr,Sa=Xo,Pa=h,Ea=rt,Ra=O,ka=bn,ja=ya,Ca=Sa&&Sa.prototype;Aa({target:'Promise',proto:!0,real:!0,forced:!!Sa&&Pa((function(){Ca.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=ka(this,Ea('Promise')),r=Ra(t);return this.then(r?function(r){return ja(e,t()).then((function(){return r}))}:t,r?function(r){return ja(e,t()).then((function(){throw r}))}:t)}});var xa=rt('Promise','finally');const Ia=(()=>{try{const t=Date.now().toString(),e=window.localStorage;e.setItem(t,t);const r=e.getItem(t)===t;return e.removeItem(t),r?e:null}catch(t){return null}})();var Na,La,Ua,qa,Ba,za,Ma,Da={get:t=>function(t){const e=Ia?Ia.getItem('_one-stat_'+t):null;if(null===e)return null;try{return JSON.parse(e)}catch(t){return null}}(t)||null,set(t,e){!function(t,e){try{Ia&&Ia.setItem('_one-stat_'+t,JSON.stringify(e))}catch(t){}}(t,e)},remove(t){!function(t){Ia&&Ia.removeItem('_one-stat_'+t)}(t)}};!function(t){t.PROD='prod',t.VK_ALIAS='vk_alias',t.VIDEOTEST='videotest',t.TEST='test',t.AUTO='auto'}(Na||(Na={})),function(t){t.Q144P='144',t.Q240P='240',t.Q360P='360',t.Q480P='480',t.Q720P='720',t.Q1080P='1080',t.Q1440P='1440',t.Q2160P='2160',t.Q4320P='4320',t.UNKNOWN='unknown'}(La||(La={})),function(t){t.CHROMECAST='chromecast',t.APPLE_TV='appletv',t.PIP='pip',t.HEADPHONES='externalHeadphones',t.SCREEN=''}(Ua||(Ua={})),function(t){t.MP4='mp4',t.DASH='dash',t.DASH_SEP='dash_sep',t.ONDEMAND_DASH='ondemand_dash',t.HLS='hls',t.ONDEMAND_HLS='ondemand_hls',t.WEBM='webm',t.RTMP='rtmp',t.UNKNOWN='unknown'}(qa||(qa={})),function(t){t.AUTO='auto',t.MANUAL=''}(Ba||(Ba={})),function(t){t.HTTP1='http1',t.HTTP2='http2',t.HTTP3='http3'}(za||(za={})),function(t){t[t.YES=1]='YES',t[t.NO=0]='NO'}(Ma||(Ma={}));const Fa={[Na.PROD]:'https://api.ok.ru',[Na.VK_ALIAS]:'https://api.mycdn.me',[Na.VIDEOTEST]:'https://videotestapi.ok.ru/api',[Na.TEST]:'https://apitest.ok.ru',[Na.AUTO]:''},$a={start:1e3,factor:1.5,max:3e5,random:.1};var Ka;!function(t){t[t.PARAM_SESSION_EXPIRED=102]='PARAM_SESSION_EXPIRED',t[t.PARAM_SESSION_KEY=103]='PARAM_SESSION_KEY',t[t.PARAM_SIGNATURE=104]='PARAM_SIGNATURE',t[t.AUTH_LOGIN=401]='AUTH_LOGIN'}(Ka||(Ka={}));class Ha{constructor(e){this.consequentAuthErrors=0,this.authorized$=new t(!1),this.params=e;const r=Da.get('uuid');r?this.uuid=String(r):(this.uuid=function(){const t='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),e=new Array(36);let r,n,o=0;for(n=0;n<36;n++)8===n||13===n||18===n||23===n?e[n]='-':14===n?e[n]='4':(o<=2&&(o=33554432+16777216*Math.random()|0),r=15&o,o>>=4,e[n]=t[19===n?3&r|8:r]);return e.join('')}(),Da.set('uuid',this.uuid))}authorize(t){return s(this,void 0,void 0,(function*(){return this.authToken=null!=t?t:yield this.refreshAuthToken(),this._authorizeWithBackoff()}))}logBeacon(t){const e=this.createLogParams(t),r=this.sessionKey;if(!r)return;this.params.apiTransport.sendBeacon('log.externalLog',e,r)||this.logRequest(t)}logRequest(t){var e;return s(this,void 0,void 0,(function*(){const r='log.externalLog',n=this.createLogParams(t),o=null!==(e=this.sessionKey)&&void 0!==e?e:yield this._authorizeWithBackoff();if(!o)return;const i=(t,e=this.params.requestRetryCount)=>s(this,void 0,void 0,(function*(){try{return yield this.params.apiTransport.sendRequest(r,n,o)}catch(n){if(!n||!('error_code'in n))return void this.params.error$.next({id:'logRequestUnknown',message:`Unknown ${r} error`,thrown:n});const o=null==n?void 0:n.error_code;switch(o){case Ka.PARAM_SESSION_EXPIRED:case Ka.PARAM_SESSION_KEY:case Ka.PARAM_SIGNATURE:return this.authorized$.next(!1),this.sessionKey=yield this._authorizeWithBackoff(),e>0?i(t,e-1):void 0;case Ka.AUTH_LOGIN:return this.authorized$.next(!1),this.authToken=yield this.refreshAuthToken(),this.sessionKey=yield this._authorizeWithBackoff(),e>0?i(t,e-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${o}`,message:`${r} error`,data:n})}}}));return i(t)}))}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}refreshAuthToken(){return s(this,void 0,void 0,(function*(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=xa(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}))}createLogParams(t){return{collector:'ok.mobile.apps.video',data:JSON.stringify({application:'@vkontakte/videoplayer-statistics:1.0.25',platform:'WEB',items:t.map((t=>Object.assign(Object.assign({},t),{time:0,type:1})))})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();const t=e(this.consequentAuthErrors,$a);return new Promise((e=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{xa(this._authorize().then(e).catch((t=>this.params.error$.next({id:'AuthorizeBackoff',message:'Otherwise unhandle errror in authrization',thrown:t}))),(()=>this.backoffTimeoutId=0))}),t))}))}_authorize(){return s(this,void 0,void 0,(function*(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);const t={session_data:{version:2,device_id:this.uuid,client_version:'1.0.25'.split('-')[0],client_type:'SDK_JS'}};return void 0!==this.authToken&&(t.session_data.auth_token=this.authToken,t.session_data.version=3),this.authorizePromise=xa(this.params.apiTransport.sendRequest('auth.anonymLogin',t).then((t=>{var e;return t&&t.session_key||this.params.error$.next({id:'AuthorizeFailed',message:'No session key',data:t}),this.sessionKey=null!==(e=null==t?void 0:t.session_key)&&void 0!==e?e:void 0,this.sessionKey})).catch((t=>s(this,void 0,void 0,(function*(){this.sessionKey=void 0;const e=null==t?void 0:t.error_code;switch(e){case Ka.AUTH_LOGIN:return this.authToken=yield this.refreshAuthToken(),this._authorizeWithBackoff()}e?this.params.error$.next({id:`Authorize#${e}`,message:'authorize error',data:t}):this.params.error$.next({id:'AuthorizeUnknown',message:'authorize error',thrown:t})})))),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}))}}function Qa(t){return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log('__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill'),!0):'function'==typeof t.Request&&!t.Request.prototype.hasOwnProperty('signal')||!t.AbortController}const Wa=Qa({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ga=Wa?function(t){'function'==typeof t&&(t={fetch:t});const{fetch:e,Request:r=e.Request,AbortController:n,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o=!1}=t;if(!Qa({fetch:e,Request:r,AbortController:n,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:e,Request:i};let i=r;(i&&!i.prototype.hasOwnProperty('signal')||o)&&(i=function(t,e){let n;e&&e.signal&&(n=e.signal,delete e.signal);const o=new r(t,e);return n&&Object.defineProperty(o,'signal',{writable:!1,enumerable:!1,configurable:!0,value:n}),o},i.prototype=r.prototype);const s=e;return{fetch:(t,e)=>{const r=i&&i.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(r){let n;try{n=new DOMException('Aborted','AbortError')}catch(t){n=new Error('Aborted'),n.name='AbortError'}if(r.aborted)return Promise.reject(n);const o=new Promise(((t,e)=>{r.addEventListener('abort',(()=>e(n)),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([o,s(t,e)])}return s(t,e)},Request:i}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ya=Wa?Ga.fetch:window.fetch;Wa?Ga.Request:window.Request;class Ja{constructor(t){this.params=t,this.apiKey=t.apiKey,this.apiEnv=t.apiEnv,this.apiBaseUrl=t.apiBaseUrl,this.isApiBaseUrlFetched=!1}resolveApiBaseUrl(){var t;return s(this,void 0,void 0,(function*(){if(this.apiEnv!==Na.AUTO||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{const e=atob('aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ='),r=yield Ya(e,{method:'GET',mode:'cors',cache:'no-cache'}),n=yield r.json(),o=null===(t=null==n?void 0:n.Answer[0])||void 0===t?void 0:t.data;if(!o)throw new Error('Wrong DNS response');return o}catch(t){return this.params.error$.next({id:'OneStat:ApiTransport:resolveApiBaseUrl',message:'Unhandled resolve api base url error',thrown:t}),Fa[Na.VK_ALIAS]}finally{this.isApiBaseUrlFetched=!0}}))}sendBeacon(t,e,r){if(!window.Blob||!window.navigator.sendBeacon)return!1;const n=this._prepareQueryParams({method:t,queryParams:e,sessionKey:r}),o=new window.Blob([n.toString()],{type:'application/x-www-form-urlencoded'});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,o)}catch(r){this.params.error$.next({id:'OneStat:ApiTransport:sendBeacon',message:'Unhandled beacon error',thrown:r,data:{method:t,params:e}})}return!1}sendRequest(t,e,r){return s(this,void 0,void 0,(function*(){const n=Date.now(),o=o=>{o instanceof TypeError&&['Failed to fetch','NetworkError when attempting to fetch resource.'].includes(o.message)?this.params.error$.next({id:'Network',message:'Request failed',thrown:o}):this.params.error$.next({id:'OneStat:ApiTransport:sendRequest',message:'Unhandled request error',thrown:o,data:{method:t,params:e,sessionKey:r,time:Date.now()-n}})};return this.apiBaseUrl=yield this.resolveApiBaseUrl(),Ya(`${this.apiBaseUrl}/fb.do`,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:this._prepareQueryParams({method:t,queryParams:e,sessionKey:r})}).then((t=>Number(t.headers.get('content-length'))>0?t.json().then((t=>Object.prototype.hasOwnProperty.call(t,'error_msg')?Promise.reject(t):t),o):void 0),o)}))}_prepareQueryParams(t){const e=new URLSearchParams({format:'JSON',method:t.method,application_key:this.apiKey});return void 0!==t.sessionKey&&e.append('session_key',t.sessionKey),Object.entries(t.queryParams).forEach((([t,r])=>e.append(t,'string'==typeof r?r:JSON.stringify(r)))),e}}class Va{constructor(t){this.requestQueue=[],this.isPaused=!1,this.debouncedFlush=i((()=>{var t;try{this.flush()}catch(e){this.error$.next({id:'LoggerError',message:null!==(t=String(e))&&void 0!==t?t:'Unknown logger error',thrown:e})}}),3e3,{maxWait:15e3}),this.api=t.api,this.error$=t.error$,this.subscription=this.api.authorized$.subscribe((t=>{t&&this.debouncedFlush()}))}log(t){this.requestQueue.push(t),this.isPaused||this.debouncedFlush()}flush(t=!1){0!==this.requestQueue.length&&(this.api.authorized$.getValue()?(t?this.api.logBeacon(this.requestQueue):this.api.logRequest(this.requestQueue),this.requestQueue=[]):t||this.api.authorize(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe()}}class Za{constructor(t,e){var i;this.subscription=new r,this.statContext=t,this.config=Object.assign(Object.assign({},null!==(i=e.config)&&void 0!==i?i:{}),{requestRetryCount:1});const s=new n;this.experimental={error$:s};const a=new Ja({apiKey:'CIOPGQJGDIHBABABA',apiBaseUrl:Fa[e.apiEnv],apiEnv:e.apiEnv,error$:s});this.api=new Ha({apiTransport:a,refreshAuthToken:e.refreshAuthToken,requestRetryCount:this.config.requestRetryCount,error$:s}),this.logger=new Va({api:this.api,error$:s}),this.subscription.add(o(window,'beforeunload').subscribe((()=>this.logger.flush(!0))))}updateContext(t){this.statContext=Object.assign(Object.assign({},this.statContext),t)}authorize(t){return this.api.authorize(t)}pause(){this.logger.pause()}resume(){this.logger.resume()}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}logInited(){this.log({operation:'init'})}logReady(t){this.log({operation:'player_ready',param:String(t.time)})}logStarted(t){this.log({operation:'play',param:String(Math.round(t.position))})}logPlay(){this.log({operation:'play_toggle'})}logPause(t){this.log({operation:'pause',param:String(Math.round(t.position))})}logSeek(){this.log({operation:'seek'})}logFirstBytes(t){this.log({operation:'first_bytes',param:String(t.time)})}logFirstFrame(t){this.log({operation:'first_frame',param:String(t.time)})}logError(t){this.log({operation:'error',param:t.errorType})}logWatchCoverageRecord(t){this.log({operation:'watch_coverage_record',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logWatchCoverageLive(t){this.log({operation:'watch_coverage_live',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logEmptyBuffer(t){this.log({operation:'empty_buffer',param:String(t.duration)})}logDownloadSpeed(t){this.log({operation:'download_speed',param:String(t.speed)})}logAdSlotRequest(){this.log({operation:'adv',param:'slot_request'})}logAdStarted(t){this.log({operation:'adv',param:t})}logAdPaused(){this.log({operation:'adv',param:'pause'})}logAdResumed(){this.log({operation:'adv',param:'resume'})}logAdEnded(){this.log({operation:'adv',param:'ended'})}logAdSkipped(){this.log({operation:'adv',param:'skip'})}logAdClicked(){this.log({operation:'adv',param:'click'})}log(t){const e=this.crateLogItem(t);this.logger.log(e)}crateLogItem({operation:t,param:e}){const r=Date.now(),n={vid:this.statContext.movieId,quality:this.statContext.quality,dst:this.statContext.destination,ct:this.statContext.contentType,aid:this.statContext.albumId,place:this.statContext.place,cdn_host:this.statContext.cdnHostname,connection_type:this.statContext.connectionType,connection_reused:!0===this.statContext.connectionReused?Ma.YES:!1===this.statContext.connectionReused?Ma.NO:void 0,stat_type:!0===this.statContext.autoplay?Ba.AUTO:!1===this.statContext.autoplay?Ba.MANUAL:void 0,vk_playlist_id:this.statContext.vkPlaylistId,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode};return void 0!==e&&(n.param=e),{operation:t,timestamp:r,custom:n}}}export{Na as ApiEnv,za as ConnectionType,qa as ContentType,Za as OneStat,La as Quality,Ua as ScreenDestination};

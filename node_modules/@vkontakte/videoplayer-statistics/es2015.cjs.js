/**
 * @vkontakte/videoplayer-statistics v1.0.25
 * Wed, 21 Sep 2022 08:17:06 GMT
 * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-25/doc/
 */
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var t=require('@vkontakte/videoplayer-shared/es2015.cjs.js');function e(t){return t&&'object'==typeof t&&'default'in t?t:{default:t}}var r=e(require('lodash/debounce.js'));function n(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))}var o='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{},i=function(t){return t&&t.Math==Math&&t},s=i('object'==typeof globalThis&&globalThis)||i('object'==typeof window&&window)||i('object'==typeof self&&self)||i('object'==typeof o&&o)||function(){return this}()||Function('return this')(),a=function(t){try{return!!t()}catch(t){return!0}},u=!a((function(){var t=function(){}.bind();return'function'!=typeof t||t.hasOwnProperty('prototype')})),c=u,h=Function.prototype,l=h.apply,f=h.call,p='object'==typeof Reflect&&Reflect.apply||(c?f.bind(l):function(){return f.apply(l,arguments)}),d=u,v=Function.prototype,y=v.bind,m=v.call,g=d&&y.bind(m,m),b=d?function(t){return t&&g(t)}:function(t){return t&&function(){return m.apply(t,arguments)}},w=function(t){return'function'==typeof t},A={},T=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),E=u,S=Function.prototype.call,_=E?S.bind(S):function(){return S.apply(S,arguments)},O={},P={}.propertyIsEnumerable,R=Object.getOwnPropertyDescriptor,x=R&&!P.call({1:2},1);O.f=x?function(t){var e=R(this,t);return!!e&&e.enumerable}:P;var j,k,C=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},I=b,N=I({}.toString),L=I(''.slice),q=function(t){return L(N(t),8,-1)},U=a,B=q,z=Object,D=b(''.split),M=U((function(){return!z('z').propertyIsEnumerable(0)}))?function(t){return'String'==B(t)?D(t,''):z(t)}:z,F=TypeError,$=function(t){if(null==t)throw F('Can\'t call method on '+t);return t},K=M,Q=$,H=w,W=function(t){return'object'==typeof t?null!==t:H(t)},G={},V=G,Y=s,J=w,Z=function(t){return J(t)?t:void 0},X=function(t,e){return arguments.length<2?Z(V[t])||Z(Y[t]):V[t]&&V[t][e]||Y[t]&&Y[t][e]},tt=b({}.isPrototypeOf),et=X('navigator','userAgent')||'',rt=s,nt=et,ot=rt.process,it=rt.Deno,st=ot&&ot.versions||it&&it.version,at=st&&st.v8;at&&(k=(j=at.split('.'))[0]>0&&j[0]<4?1:+(j[0]+j[1])),!k&&nt&&(!(j=nt.match(/Edge\/(\d+)/))||j[1]>=74)&&(j=nt.match(/Chrome\/(\d+)/))&&(k=+j[1]);var ut=k,ct=ut,ht=a,lt=!!Object.getOwnPropertySymbols&&!ht((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ct&&ct<41})),ft=lt&&!Symbol.sham&&'symbol'==typeof Symbol.iterator,pt=X,dt=w,vt=tt,yt=Object,mt=ft?function(t){return'symbol'==typeof t}:function(t){var e=pt('Symbol');return dt(e)&&vt(e.prototype,yt(t))},gt=String,bt=function(t){try{return gt(t)}catch(t){return'Object'}},wt=w,At=bt,Tt=TypeError,Et=function(t){if(wt(t))return t;throw Tt(At(t)+' is not a function')},St=Et,_t=function(t,e){var r=t[e];return null==r?void 0:St(r)},Ot=_,Pt=w,Rt=W,xt=TypeError,jt={exports:{}},kt=s,Ct=Object.defineProperty,It=function(t,e){try{Ct(kt,t,{value:e,configurable:!0,writable:!0})}catch(r){kt[t]=e}return e},Nt=s['__core-js_shared__']||It('__core-js_shared__',{}),Lt=Nt;(jt.exports=function(t,e){return Lt[t]||(Lt[t]=void 0!==e?e:{})})('versions',[]).push({version:'3.24.1',mode:'pure',copyright:'Â© 2014-2022 Denis Pushkarev (zloirock.ru)',license:'https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE',source:'https://github.com/zloirock/core-js'});var qt=$,Ut=Object,Bt=function(t){return Ut(qt(t))},zt=b({}.hasOwnProperty),Dt=Object.hasOwn||function(t,e){return zt(Bt(t),e)},Mt=b,Ft=0,$t=Math.random(),Kt=Mt(1..toString),Qt=function(t){return'Symbol('+(void 0===t?'':t)+')_'+Kt(++Ft+$t,36)},Ht=s,Wt=jt.exports,Gt=Dt,Vt=Qt,Yt=lt,Jt=ft,Zt=Wt('wks'),Xt=Ht.Symbol,te=Xt&&Xt.for,ee=Jt?Xt:Xt&&Xt.withoutSetter||Vt,re=function(t){if(!Gt(Zt,t)||!Yt&&'string'!=typeof Zt[t]){var e='Symbol.'+t;Yt&&Gt(Xt,t)?Zt[t]=Xt[t]:Zt[t]=Jt&&te?te(e):ee(e)}return Zt[t]},ne=_,oe=W,ie=mt,se=_t,ae=function(t,e){var r,n;if('string'===e&&Pt(r=t.toString)&&!Rt(n=Ot(r,t)))return n;if(Pt(r=t.valueOf)&&!Rt(n=Ot(r,t)))return n;if('string'!==e&&Pt(r=t.toString)&&!Rt(n=Ot(r,t)))return n;throw xt('Can\'t convert object to primitive value')},ue=TypeError,ce=re('toPrimitive'),he=function(t,e){if(!oe(t)||ie(t))return t;var r,n=se(t,ce);if(n){if(void 0===e&&(e='default'),r=ne(n,t,e),!oe(r)||ie(r))return r;throw ue('Can\'t convert object to primitive value')}return void 0===e&&(e='number'),ae(t,e)},le=mt,fe=function(t){var e=he(t,'string');return le(e)?e:e+''},pe=W,de=s.document,ve=pe(de)&&pe(de.createElement),ye=function(t){return ve?de.createElement(t):{}},me=ye,ge=!T&&!a((function(){return 7!=Object.defineProperty(me('div'),'a',{get:function(){return 7}}).a})),be=T,we=_,Ae=O,Te=C,Ee=function(t){return K(Q(t))},Se=fe,_e=Dt,Oe=ge,Pe=Object.getOwnPropertyDescriptor;A.f=be?Pe:function(t,e){if(t=Ee(t),e=Se(e),Oe)try{return Pe(t,e)}catch(t){}if(_e(t,e))return Te(!we(Ae.f,t,e),t[e])};var Re=a,xe=w,je=/#|\.prototype\./,ke=function(t,e){var r=Ie[Ce(t)];return r==Le||r!=Ne&&(xe(e)?Re(e):!!e)},Ce=ke.normalize=function(t){return String(t).replace(je,'.').toLowerCase()},Ie=ke.data={},Ne=ke.NATIVE='N',Le=ke.POLYFILL='P',qe=ke,Ue=Et,Be=u,ze=b(b.bind),De=function(t,e){return Ue(t),void 0===e?t:Be?ze(t,e):function(){return t.apply(e,arguments)}},Me={},Fe=T&&a((function(){return 42!=Object.defineProperty((function(){}),'prototype',{value:42,writable:!1}).prototype})),$e=W,Ke=String,Qe=TypeError,He=function(t){if($e(t))return t;throw Qe(Ke(t)+' is not an object')},We=T,Ge=ge,Ve=Fe,Ye=He,Je=fe,Ze=TypeError,Xe=Object.defineProperty,tr=Object.getOwnPropertyDescriptor;Me.f=We?Ve?function(t,e,r){if(Ye(t),e=Je(e),Ye(r),'function'==typeof t&&'prototype'===e&&'value'in r&&'writable'in r&&!r.writable){var n=tr(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:'configurable'in r?r.configurable:n.configurable,enumerable:'enumerable'in r?r.enumerable:n.enumerable,writable:!1})}return Xe(t,e,r)}:Xe:function(t,e,r){if(Ye(t),e=Je(e),Ye(r),Ge)try{return Xe(t,e,r)}catch(t){}if('get'in r||'set'in r)throw Ze('Accessors not supported');return'value'in r&&(t[e]=r.value),t};var er=Me,rr=C,nr=T?function(t,e,r){return er.f(t,e,rr(1,r))}:function(t,e,r){return t[e]=r,t},or=s,ir=p,sr=b,ar=w,ur=A.f,cr=qe,hr=G,lr=De,fr=nr,pr=Dt,dr=function(t){var e=function(r,n,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,n)}return new t(r,n,o)}return ir(t,this,arguments)};return e.prototype=t.prototype,e},vr=function(t,e){var r,n,o,i,s,a,u,c,h=t.target,l=t.global,f=t.stat,p=t.proto,d=l?or:f?or[h]:(or[h]||{}).prototype,v=l?hr:hr[h]||fr(hr,h,{})[h],y=v.prototype;for(o in e)r=!cr(l?o:h+(f?'.':'#')+o,t.forced)&&d&&pr(d,o),s=v[o],r&&(a=t.dontCallGetSet?(c=ur(d,o))&&c.value:d[o]),i=r&&a?a:e[o],r&&typeof s==typeof i||(u=t.bind&&r?lr(i,or):t.wrap&&r?dr(i):p&&ar(i)?sr(i):i,(t.sham||i&&i.sham||s&&s.sham)&&fr(u,'sham',!0),fr(v,o,u),p&&(pr(hr,n=h+'Prototype')||fr(hr,n,{}),fr(hr[n],o,i),t.real&&y&&!y[o]&&fr(y,o,i)))},yr='process'==q(s.process),mr=nr,gr=(TypeError,b);Object.setPrototypeOf||'__proto__'in{}&&function(){var t,e=!1,r={};try{(t=gr(Object.getOwnPropertyDescriptor(Object.prototype,'__proto__').set))(r,[]),e=r instanceof Array}catch(t){}}();var br={};br[re('toStringTag')]='z';var wr='[object z]'===String(br),Ar=wr,Tr=w,Er=q,Sr=re('toStringTag'),_r=Object,Or='Arguments'==Er(function(){return arguments}()),Pr=Ar?Er:function(t){var e,r,n;return void 0===t?'Undefined':null===t?'Null':'string'==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=_r(t),Sr))?r:Or?Er(e):'Object'==(n=Er(e))&&Tr(e.callee)?'Arguments':n},Rr=Pr,xr=wr?{}.toString:function(){return'[object '+Rr(this)+']'},jr=wr,kr=Me.f,Cr=nr,Ir=Dt,Nr=xr,Lr=re('toStringTag'),qr=X,Ur=Me,Br=T,zr=re('species'),Dr=tt,Mr=TypeError,Fr=w,$r=Nt,Kr=b(Function.toString);Fr($r.inspectSource)||($r.inspectSource=function(t){return Kr(t)});var Qr=$r.inspectSource,Hr=b,Wr=a,Gr=w,Vr=Pr,Yr=Qr,Jr=function(){},Zr=[],Xr=X('Reflect','construct'),tn=/^\s*(?:class|function)\b/,en=Hr(tn.exec),rn=!tn.exec(Jr),nn=function(t){if(!Gr(t))return!1;try{return Xr(Jr,Zr,t),!0}catch(t){return!1}},on=function(t){if(!Gr(t))return!1;switch(Vr(t)){case'AsyncFunction':case'GeneratorFunction':case'AsyncGeneratorFunction':return!1}try{return rn||!!en(tn,Yr(t))}catch(t){return!0}};on.sham=!0;var sn,an,un,cn,hn=!Xr||Wr((function(){var t;return nn(nn.call)||!nn(Object)||!nn((function(){t=!0}))||t}))?on:nn,ln=bt,fn=TypeError,pn=He,dn=function(t){if(hn(t))return t;throw fn(ln(t)+' is not a constructor')},vn=re('species'),yn=function(t,e){var r,n=pn(t).constructor;return void 0===n||null==(r=pn(n)[vn])?e:dn(r)},mn=X('document','documentElement'),gn=b([].slice),bn=TypeError,wn=/(?:ipad|iphone|ipod).*applewebkit/i.test(et),An=s,Tn=p,En=De,Sn=w,_n=Dt,On=a,Pn=mn,Rn=gn,xn=ye,jn=function(t,e){if(t<e)throw bn('Not enough arguments');return t},kn=wn,Cn=yr,In=An.setImmediate,Nn=An.clearImmediate,Ln=An.process,qn=An.Dispatch,Un=An.Function,Bn=An.MessageChannel,zn=An.String,Dn=0,Mn={};try{sn=An.location}catch(t){}var Fn=function(t){if(_n(Mn,t)){var e=Mn[t];delete Mn[t],e()}},$n=function(t){return function(){Fn(t)}},Kn=function(t){Fn(t.data)},Qn=function(t){An.postMessage(zn(t),sn.protocol+'//'+sn.host)};In&&Nn||(In=function(t){jn(arguments.length,1);var e=Sn(t)?t:Un(t),r=Rn(arguments,1);return Mn[++Dn]=function(){Tn(e,void 0,r)},an(Dn),Dn},Nn=function(t){delete Mn[t]},Cn?an=function(t){Ln.nextTick($n(t))}:qn&&qn.now?an=function(t){qn.now($n(t))}:Bn&&!kn?(cn=(un=new Bn).port2,un.port1.onmessage=Kn,an=En(cn.postMessage,cn)):An.addEventListener&&Sn(An.postMessage)&&!An.importScripts&&sn&&'file:'!==sn.protocol&&!On(Qn)?(an=Qn,An.addEventListener('message',Kn,!1)):an='onreadystatechange'in xn('script')?function(t){Pn.appendChild(xn('script')).onreadystatechange=function(){Pn.removeChild(this),Fn(t)}}:function(t){setTimeout($n(t),0)});var Hn,Wn,Gn,Vn,Yn,Jn,Zn,Xn,to={set:In,clear:Nn},eo=s,ro=/ipad|iphone|ipod/i.test(et)&&void 0!==eo.Pebble,no=/web0s(?!.*chrome)/i.test(et),oo=s,io=De,so=A.f,ao=to.set,uo=wn,co=ro,ho=no,lo=yr,fo=oo.MutationObserver||oo.WebKitMutationObserver,po=oo.document,vo=oo.process,yo=oo.Promise,mo=so(oo,'queueMicrotask'),go=mo&&mo.value;go||(Hn=function(){var t,e;for(lo&&(t=vo.domain)&&t.exit();Wn;){e=Wn.fn,Wn=Wn.next;try{e()}catch(t){throw Wn?Vn():Gn=void 0,t}}Gn=void 0,t&&t.enter()},uo||lo||ho||!fo||!po?!co&&yo&&yo.resolve?((Zn=yo.resolve(void 0)).constructor=yo,Xn=io(Zn.then,Zn),Vn=function(){Xn(Hn)}):lo?Vn=function(){vo.nextTick(Hn)}:(ao=io(ao,oo),Vn=function(){ao(Hn)}):(Yn=!0,Jn=po.createTextNode(''),new fo(Hn).observe(Jn,{characterData:!0}),Vn=function(){Jn.data=Yn=!Yn}));var bo=go||function(t){var e={fn:t,next:void 0};Gn&&(Gn.next=e),Wn||(Wn=e,Vn()),Gn=e},wo=s,Ao=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},To=function(){this.head=null,this.tail=null};To.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Eo,So,_o,Oo=To,Po=w,Ro=Qr,xo=s.WeakMap,jo=Po(xo)&&/native code/.test(Ro(xo)),ko=jt.exports,Co=Qt,Io=ko('keys'),No=jo,Lo=s,qo=b,Uo=W,Bo=nr,zo=Dt,Do=Nt,Mo=function(t){return Io[t]||(Io[t]=Co(t))},Fo=Lo.TypeError,$o=Lo.WeakMap;if(No||Do.state){var Ko=Do.state||(Do.state=new $o),Qo=qo(Ko.get),Ho=qo(Ko.has),Wo=qo(Ko.set);Eo=function(t,e){if(Ho(Ko,t))throw new Fo('Object already initialized');return e.facade=t,Wo(Ko,t,e),e},So=function(t){return Qo(Ko,t)||{}},_o=function(t){return Ho(Ko,t)}}else{var Go=Mo('state');Eo=function(t,e){if(zo(t,Go))throw new Fo('Object already initialized');return e.facade=t,Bo(t,Go,e),e},So=function(t){return zo(t,Go)?t[Go]:{}},_o=function(t){return zo(t,Go)}}var Vo={set:Eo,get:So,has:_o,enforce:function(t){return _o(t)?So(t):Eo(t,{})},getterFor:function(t){return function(e){var r;if(!Uo(e)||(r=So(e)).type!==t)throw Fo('Incompatible receiver, '+t+' required');return r}}},Yo=s.Promise,Jo='object'==typeof Deno&&Deno&&'object'==typeof Deno.version,Zo=!Jo&&!yr&&'object'==typeof window&&'object'==typeof document,Xo=s,ti=Yo,ei=w,ri=qe,ni=Qr,oi=re,ii=Zo,si=Jo,ai=ut,ui=ti&&ti.prototype,ci=oi('species'),hi=!1,li=ei(Xo.PromiseRejectionEvent),fi={CONSTRUCTOR:ri('Promise',(function(){var t=ni(ti),e=t!==String(ti);if(!e&&66===ai)return!0;if(!ui.catch||!ui.finally)return!0;if(!ai||ai<51||!/native code/.test(t)){var r=new ti((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[ci]=n,!(hi=r.then((function(){}))instanceof n))return!0}return!e&&(ii||si)&&!li})),REJECTION_EVENT:li,SUBCLASSING:hi},pi={},di=Et,vi=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw TypeError('Bad Promise constructor');e=t,r=n})),this.resolve=di(e),this.reject=di(r)};pi.f=function(t){return new vi(t)};var yi,mi,gi=vr,bi=yr,wi=s,Ai=_,Ti=function(t,e,r,n){return n&&n.enumerable?t[e]=r:mr(t,e,r),t},Ei=function(t,e,r,n){if(t){var o=r?t:t.prototype;Ir(o,Lr)||kr(o,Lr,{configurable:!0,value:e}),n&&!jr&&Cr(o,'toString',Nr)}},Si=function(t){var e=qr(t),r=Ur.f;Br&&e&&!e[zr]&&r(e,zr,{configurable:!0,get:function(){return this}})},_i=Et,Oi=w,Pi=W,Ri=function(t,e){if(Dr(e,t))return t;throw Mr('Incorrect invocation')},xi=yn,ji=to.set,ki=bo,Ci=function(t,e){var r=wo.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))},Ii=Ao,Ni=Oo,Li=Vo,qi=Yo,Ui=pi,Bi=fi.CONSTRUCTOR,zi=fi.REJECTION_EVENT,Di=Li.getterFor('Promise'),Mi=Li.set,Fi=qi&&qi.prototype,$i=qi,Ki=Fi,Qi=wi.TypeError,Hi=wi.document,Wi=wi.process,Gi=Ui.f,Vi=Gi,Yi=!!(Hi&&Hi.createEvent&&wi.dispatchEvent),Ji=function(t){var e;return!(!Pi(t)||!Oi(e=t.then))&&e},Zi=function(t,e){var r,n,o,i=e.value,s=1==e.state,a=s?t.ok:t.fail,u=t.resolve,c=t.reject,h=t.domain;try{a?(s||(2===e.rejection&&ns(e),e.rejection=1),!0===a?r=i:(h&&h.enter(),r=a(i),h&&(h.exit(),o=!0)),r===t.promise?c(Qi('Promise-chain cycle')):(n=Ji(r))?Ai(n,r,u,c):u(r)):c(i)}catch(t){h&&!o&&h.exit(),c(t)}},Xi=function(t,e){t.notified||(t.notified=!0,ki((function(){for(var r,n=t.reactions;r=n.get();)Zi(r,t);t.notified=!1,e&&!t.rejection&&es(t)})))},ts=function(t,e,r){var n,o;Yi?((n=Hi.createEvent('Event')).promise=e,n.reason=r,n.initEvent(t,!1,!0),wi.dispatchEvent(n)):n={promise:e,reason:r},!zi&&(o=wi['on'+t])?o(n):'unhandledrejection'===t&&Ci('Unhandled promise rejection',r)},es=function(t){Ai(ji,wi,(function(){var e,r=t.facade,n=t.value;if(rs(t)&&(e=Ii((function(){bi?Wi.emit('unhandledRejection',n,r):ts('unhandledrejection',r,n)})),t.rejection=bi||rs(t)?2:1,e.error))throw e.value}))},rs=function(t){return 1!==t.rejection&&!t.parent},ns=function(t){Ai(ji,wi,(function(){var e=t.facade;bi?Wi.emit('rejectionHandled',e):ts('rejectionhandled',e,t.value)}))},os=function(t,e,r){return function(n){t(e,n,r)}},is=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,Xi(t,!0))},ss=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qi('Promise can\'t be resolved itself');var n=Ji(e);n?ki((function(){var r={done:!1};try{Ai(n,e,os(ss,r,t),os(is,r,t))}catch(e){is(r,e,t)}})):(t.value=e,t.state=1,Xi(t,!1))}catch(e){is({done:!1},e,t)}}};Bi&&(Ki=($i=function(t){Ri(this,Ki),_i(t),Ai(yi,this);var e=Di(this);try{t(os(ss,e),os(is,e))}catch(t){is(e,t)}}).prototype,(yi=function(t){Mi(this,{type:'Promise',done:!1,notified:!1,parent:!1,reactions:new Ni,rejection:!1,state:0,value:void 0})}).prototype=Ti(Ki,'then',(function(t,e){var r=Di(this),n=Gi(xi(this,$i));return r.parent=!0,n.ok=!Oi(t)||t,n.fail=Oi(e)&&e,n.domain=bi?Wi.domain:void 0,0==r.state?r.reactions.add(n):ki((function(){Zi(n,r)})),n.promise})),mi=function(){var t=new yi,e=Di(t);this.promise=t,this.resolve=os(ss,e),this.reject=os(is,e)},Ui.f=Gi=function(t){return t===$i||undefined===t?new mi(t):Vi(t)}),gi({global:!0,constructor:!0,wrap:!0,forced:Bi},{Promise:$i}),Ei($i,'Promise',!1,!0),Si('Promise');var as={},us=as,cs=re('iterator'),hs=Array.prototype,ls=Math.ceil,fs=Math.floor,ps=Math.trunc||function(t){var e=+t;return(e>0?fs:ls)(e)},ds=function(t){var e=+t;return e!=e||0===e?0:ps(e)},vs=Math.min,ys=function(t){return t>0?vs(ds(t),9007199254740991):0},ms=Pr,gs=_t,bs=as,ws=re('iterator'),As=function(t){if(null!=t)return gs(t,ws)||gs(t,'@@iterator')||bs[ms(t)]},Ts=_,Es=Et,Ss=He,_s=bt,Os=As,Ps=TypeError,Rs=_,xs=He,js=_t,ks=De,Cs=_,Is=He,Ns=bt,Ls=function(t){return void 0!==t&&(us.Array===t||hs[cs]===t)},qs=function(t){return ys(t.length)},Us=tt,Bs=function(t,e){var r=arguments.length<2?Os(t):e;if(Es(r))return Ss(Ts(r,t));throw Ps(_s(t)+' is not iterable')},zs=As,Ds=function(t,e,r){var n,o;xs(t);try{if(!(n=js(t,'return'))){if('throw'===e)throw r;return r}n=Rs(n,t)}catch(t){o=!0,n=t}if('throw'===e)throw r;if(o)throw n;return xs(n),r},Ms=TypeError,Fs=function(t,e){this.stopped=t,this.result=e},$s=Fs.prototype,Ks=function(t,e,r){var n,o,i,s,a,u,c,h=r&&r.that,l=!(!r||!r.AS_ENTRIES),f=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),d=!(!r||!r.INTERRUPTED),v=ks(e,h),y=function(t){return n&&Ds(n,'normal',t),new Fs(!0,t)},m=function(t){return l?(Is(t),d?v(t[0],t[1],y):v(t[0],t[1])):d?v(t,y):v(t)};if(f)n=t.iterator;else if(p)n=t;else{if(!(o=zs(t)))throw Ms(Ns(t)+' is not iterable');if(Ls(o)){for(i=0,s=qs(t);s>i;i++)if((a=m(t[i]))&&Us($s,a))return a;return new Fs(!1)}n=Bs(t,o)}for(u=f?t.next:n.next;!(c=Cs(u,n)).done;){try{a=m(c.value)}catch(t){Ds(n,'throw',t)}if('object'==typeof a&&a&&Us($s,a))return a}return new Fs(!1)},Qs=re('iterator'),Hs=!1;try{var Ws=0,Gs={next:function(){return{done:!!Ws++}},return:function(){Hs=!0}};Gs[Qs]=function(){return this},Array.from(Gs,(function(){throw 2}))}catch(t){}var Vs=Yo,Ys=fi.CONSTRUCTOR||!function(t,e){if(!e&&!Hs)return!1;var r=!1;try{var n={};n[Qs]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r}((function(t){Vs.all(t).then(void 0,(function(){}))})),Js=_,Zs=Et,Xs=pi,ta=Ao,ea=Ks;vr({target:'Promise',stat:!0,forced:Ys},{all:function(t){var e=this,r=Xs.f(e),n=r.resolve,o=r.reject,i=ta((function(){var r=Zs(e.resolve),i=[],s=0,a=1;ea(t,(function(t){var u=s++,c=!1;a++,Js(r,e,t).then((function(t){c||(c=!0,i[u]=t,--a||n(i))}),o)})),--a||n(i)}));return i.error&&o(i.value),r.promise}});var ra=vr,na=fi.CONSTRUCTOR;Yo&&Yo.prototype,ra({target:'Promise',proto:!0,forced:na,real:!0},{catch:function(t){return this.then(void 0,t)}});var oa=_,ia=Et,sa=pi,aa=Ao,ua=Ks;vr({target:'Promise',stat:!0,forced:Ys},{race:function(t){var e=this,r=sa.f(e),n=r.reject,o=aa((function(){var o=ia(e.resolve);ua(t,(function(t){oa(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}});var ca=_,ha=pi;vr({target:'Promise',stat:!0,forced:fi.CONSTRUCTOR},{reject:function(t){var e=ha.f(this);return ca(e.reject,void 0,t),e.promise}});var la=He,fa=W,pa=pi,da=function(t,e){if(la(t),fa(e)&&e.constructor===t)return e;var r=pa.f(t);return(0,r.resolve)(e),r.promise},va=vr,ya=Yo,ma=fi.CONSTRUCTOR,ga=da,ba=X('Promise'),wa=!ma;va({target:'Promise',stat:!0,forced:true},{resolve:function(t){return ga(wa&&this===ba?ya:this,t)}});var Aa=vr,Ta=Yo,Ea=a,Sa=X,_a=w,Oa=yn,Pa=da,Ra=Ta&&Ta.prototype;Aa({target:'Promise',proto:!0,real:!0,forced:!!Ta&&Ea((function(){Ra.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=Oa(this,Sa('Promise')),r=_a(t);return this.then(r?function(r){return Pa(e,t()).then((function(){return r}))}:t,r?function(r){return Pa(e,t()).then((function(){throw r}))}:t)}});var xa=X('Promise','finally');const ja=(()=>{try{const t=Date.now().toString(),e=window.localStorage;e.setItem(t,t);const r=e.getItem(t)===t;return e.removeItem(t),r?e:null}catch(t){return null}})();var ka,Ca,Ia,Na,La,qa,Ua,Ba={get:t=>function(t){const e=ja?ja.getItem('_one-stat_'+t):null;if(null===e)return null;try{return JSON.parse(e)}catch(t){return null}}(t)||null,set(t,e){!function(t,e){try{ja&&ja.setItem('_one-stat_'+t,JSON.stringify(e))}catch(t){}}(t,e)},remove(t){!function(t){ja&&ja.removeItem('_one-stat_'+t)}(t)}};exports.ApiEnv=void 0,(ka=exports.ApiEnv||(exports.ApiEnv={})).PROD='prod',ka.VK_ALIAS='vk_alias',ka.VIDEOTEST='videotest',ka.TEST='test',ka.AUTO='auto',exports.Quality=void 0,(Ca=exports.Quality||(exports.Quality={})).Q144P='144',Ca.Q240P='240',Ca.Q360P='360',Ca.Q480P='480',Ca.Q720P='720',Ca.Q1080P='1080',Ca.Q1440P='1440',Ca.Q2160P='2160',Ca.Q4320P='4320',Ca.UNKNOWN='unknown',exports.ScreenDestination=void 0,(Ia=exports.ScreenDestination||(exports.ScreenDestination={})).CHROMECAST='chromecast',Ia.APPLE_TV='appletv',Ia.PIP='pip',Ia.HEADPHONES='externalHeadphones',Ia.SCREEN='',exports.ContentType=void 0,(Na=exports.ContentType||(exports.ContentType={})).MP4='mp4',Na.DASH='dash',Na.DASH_SEP='dash_sep',Na.ONDEMAND_DASH='ondemand_dash',Na.HLS='hls',Na.ONDEMAND_HLS='ondemand_hls',Na.WEBM='webm',Na.RTMP='rtmp',Na.UNKNOWN='unknown',function(t){t.AUTO='auto',t.MANUAL=''}(La||(La={})),exports.ConnectionType=void 0,(qa=exports.ConnectionType||(exports.ConnectionType={})).HTTP1='http1',qa.HTTP2='http2',qa.HTTP3='http3',function(t){t[t.YES=1]='YES',t[t.NO=0]='NO'}(Ua||(Ua={}));const za={[exports.ApiEnv.PROD]:'https://api.ok.ru',[exports.ApiEnv.VK_ALIAS]:'https://api.mycdn.me',[exports.ApiEnv.VIDEOTEST]:'https://videotestapi.ok.ru/api',[exports.ApiEnv.TEST]:'https://apitest.ok.ru',[exports.ApiEnv.AUTO]:''},Da={start:1e3,factor:1.5,max:3e5,random:.1};var Ma;!function(t){t[t.PARAM_SESSION_EXPIRED=102]='PARAM_SESSION_EXPIRED',t[t.PARAM_SESSION_KEY=103]='PARAM_SESSION_KEY',t[t.PARAM_SIGNATURE=104]='PARAM_SIGNATURE',t[t.AUTH_LOGIN=401]='AUTH_LOGIN'}(Ma||(Ma={}));class Fa{constructor(e){this.consequentAuthErrors=0,this.authorized$=new t.ValueSubject(!1),this.params=e;const r=Ba.get('uuid');r?this.uuid=String(r):(this.uuid=function(){const t='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),e=new Array(36);let r,n,o=0;for(n=0;n<36;n++)8===n||13===n||18===n||23===n?e[n]='-':14===n?e[n]='4':(o<=2&&(o=33554432+16777216*Math.random()|0),r=15&o,o>>=4,e[n]=t[19===n?3&r|8:r]);return e.join('')}(),Ba.set('uuid',this.uuid))}authorize(t){return n(this,void 0,void 0,(function*(){return this.authToken=null!=t?t:yield this.refreshAuthToken(),this._authorizeWithBackoff()}))}logBeacon(t){const e=this.createLogParams(t),r=this.sessionKey;if(!r)return;this.params.apiTransport.sendBeacon('log.externalLog',e,r)||this.logRequest(t)}logRequest(t){var e;return n(this,void 0,void 0,(function*(){const r='log.externalLog',o=this.createLogParams(t),i=null!==(e=this.sessionKey)&&void 0!==e?e:yield this._authorizeWithBackoff();if(!i)return;const s=(t,e=this.params.requestRetryCount)=>n(this,void 0,void 0,(function*(){try{return yield this.params.apiTransport.sendRequest(r,o,i)}catch(n){if(!n||!('error_code'in n))return void this.params.error$.next({id:'logRequestUnknown',message:`Unknown ${r} error`,thrown:n});const o=null==n?void 0:n.error_code;switch(o){case Ma.PARAM_SESSION_EXPIRED:case Ma.PARAM_SESSION_KEY:case Ma.PARAM_SIGNATURE:return this.authorized$.next(!1),this.sessionKey=yield this._authorizeWithBackoff(),e>0?s(t,e-1):void 0;case Ma.AUTH_LOGIN:return this.authorized$.next(!1),this.authToken=yield this.refreshAuthToken(),this.sessionKey=yield this._authorizeWithBackoff(),e>0?s(t,e-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${o}`,message:`${r} error`,data:n})}}}));return s(t)}))}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}refreshAuthToken(){return n(this,void 0,void 0,(function*(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=xa(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}))}createLogParams(t){return{collector:'ok.mobile.apps.video',data:JSON.stringify({application:'@vkontakte/videoplayer-statistics:1.0.25',platform:'WEB',items:t.map((t=>Object.assign(Object.assign({},t),{time:0,type:1})))})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();const e=t.getExponentialDelay(this.consequentAuthErrors,Da);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{xa(this._authorize().then(t).catch((t=>this.params.error$.next({id:'AuthorizeBackoff',message:'Otherwise unhandle errror in authrization',thrown:t}))),(()=>this.backoffTimeoutId=0))}),e))}))}_authorize(){return n(this,void 0,void 0,(function*(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);const t={session_data:{version:2,device_id:this.uuid,client_version:'1.0.25'.split('-')[0],client_type:'SDK_JS'}};return void 0!==this.authToken&&(t.session_data.auth_token=this.authToken,t.session_data.version=3),this.authorizePromise=xa(this.params.apiTransport.sendRequest('auth.anonymLogin',t).then((t=>{var e;return t&&t.session_key||this.params.error$.next({id:'AuthorizeFailed',message:'No session key',data:t}),this.sessionKey=null!==(e=null==t?void 0:t.session_key)&&void 0!==e?e:void 0,this.sessionKey})).catch((t=>n(this,void 0,void 0,(function*(){this.sessionKey=void 0;const e=null==t?void 0:t.error_code;switch(e){case Ma.AUTH_LOGIN:return this.authToken=yield this.refreshAuthToken(),this._authorizeWithBackoff()}e?this.params.error$.next({id:`Authorize#${e}`,message:'authorize error',data:t}):this.params.error$.next({id:'AuthorizeUnknown',message:'authorize error',thrown:t})})))),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}))}}function $a(t){return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log('__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill'),!0):'function'==typeof t.Request&&!t.Request.prototype.hasOwnProperty('signal')||!t.AbortController}const Ka=$a({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Qa=Ka?function(t){'function'==typeof t&&(t={fetch:t});const{fetch:e,Request:r=e.Request,AbortController:n,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o=!1}=t;if(!$a({fetch:e,Request:r,AbortController:n,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:e,Request:i};let i=r;(i&&!i.prototype.hasOwnProperty('signal')||o)&&(i=function(t,e){let n;e&&e.signal&&(n=e.signal,delete e.signal);const o=new r(t,e);return n&&Object.defineProperty(o,'signal',{writable:!1,enumerable:!1,configurable:!0,value:n}),o},i.prototype=r.prototype);const s=e;return{fetch:(t,e)=>{const r=i&&i.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(r){let n;try{n=new DOMException('Aborted','AbortError')}catch(t){n=new Error('Aborted'),n.name='AbortError'}if(r.aborted)return Promise.reject(n);const o=new Promise(((t,e)=>{r.addEventListener('abort',(()=>e(n)),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([o,s(t,e)])}return s(t,e)},Request:i}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ha=Ka?Qa.fetch:window.fetch;Ka?Qa.Request:window.Request;class Wa{constructor(t){this.params=t,this.apiKey=t.apiKey,this.apiEnv=t.apiEnv,this.apiBaseUrl=t.apiBaseUrl,this.isApiBaseUrlFetched=!1}resolveApiBaseUrl(){var t;return n(this,void 0,void 0,(function*(){if(this.apiEnv!==exports.ApiEnv.AUTO||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{const e=atob('aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ='),r=yield Ha(e,{method:'GET',mode:'cors',cache:'no-cache'}),n=yield r.json(),o=null===(t=null==n?void 0:n.Answer[0])||void 0===t?void 0:t.data;if(!o)throw new Error('Wrong DNS response');return o}catch(t){return this.params.error$.next({id:'OneStat:ApiTransport:resolveApiBaseUrl',message:'Unhandled resolve api base url error',thrown:t}),za[exports.ApiEnv.VK_ALIAS]}finally{this.isApiBaseUrlFetched=!0}}))}sendBeacon(t,e,r){if(!window.Blob||!window.navigator.sendBeacon)return!1;const n=this._prepareQueryParams({method:t,queryParams:e,sessionKey:r}),o=new window.Blob([n.toString()],{type:'application/x-www-form-urlencoded'});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,o)}catch(r){this.params.error$.next({id:'OneStat:ApiTransport:sendBeacon',message:'Unhandled beacon error',thrown:r,data:{method:t,params:e}})}return!1}sendRequest(t,e,r){return n(this,void 0,void 0,(function*(){const n=Date.now(),o=o=>{o instanceof TypeError&&['Failed to fetch','NetworkError when attempting to fetch resource.'].includes(o.message)?this.params.error$.next({id:'Network',message:'Request failed',thrown:o}):this.params.error$.next({id:'OneStat:ApiTransport:sendRequest',message:'Unhandled request error',thrown:o,data:{method:t,params:e,sessionKey:r,time:Date.now()-n}})};return this.apiBaseUrl=yield this.resolveApiBaseUrl(),Ha(`${this.apiBaseUrl}/fb.do`,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:this._prepareQueryParams({method:t,queryParams:e,sessionKey:r})}).then((t=>Number(t.headers.get('content-length'))>0?t.json().then((t=>Object.prototype.hasOwnProperty.call(t,'error_msg')?Promise.reject(t):t),o):void 0),o)}))}_prepareQueryParams(t){const e=new URLSearchParams({format:'JSON',method:t.method,application_key:this.apiKey});return void 0!==t.sessionKey&&e.append('session_key',t.sessionKey),Object.entries(t.queryParams).forEach((([t,r])=>e.append(t,'string'==typeof r?r:JSON.stringify(r)))),e}}class Ga{constructor(t){this.requestQueue=[],this.isPaused=!1,this.debouncedFlush=r.default((()=>{var t;try{this.flush()}catch(e){this.error$.next({id:'LoggerError',message:null!==(t=String(e))&&void 0!==t?t:'Unknown logger error',thrown:e})}}),3e3,{maxWait:15e3}),this.api=t.api,this.error$=t.error$,this.subscription=this.api.authorized$.subscribe((t=>{t&&this.debouncedFlush()}))}log(t){this.requestQueue.push(t),this.isPaused||this.debouncedFlush()}flush(t=!1){0!==this.requestQueue.length&&(this.api.authorized$.getValue()?(t?this.api.logBeacon(this.requestQueue):this.api.logRequest(this.requestQueue),this.requestQueue=[]):t||this.api.authorize(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe()}}exports.OneStat=class{constructor(e,r){var n;this.subscription=new t.Subscription,this.statContext=e,this.config=Object.assign(Object.assign({},null!==(n=r.config)&&void 0!==n?n:{}),{requestRetryCount:1});const o=new t.Subject;this.experimental={error$:o};const i=new Wa({apiKey:'CIOPGQJGDIHBABABA',apiBaseUrl:za[r.apiEnv],apiEnv:r.apiEnv,error$:o});this.api=new Fa({apiTransport:i,refreshAuthToken:r.refreshAuthToken,requestRetryCount:this.config.requestRetryCount,error$:o}),this.logger=new Ga({api:this.api,error$:o}),this.subscription.add(t.fromEvent(window,'beforeunload').subscribe((()=>this.logger.flush(!0))))}updateContext(t){this.statContext=Object.assign(Object.assign({},this.statContext),t)}authorize(t){return this.api.authorize(t)}pause(){this.logger.pause()}resume(){this.logger.resume()}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}logInited(){this.log({operation:'init'})}logReady(t){this.log({operation:'player_ready',param:String(t.time)})}logStarted(t){this.log({operation:'play',param:String(Math.round(t.position))})}logPlay(){this.log({operation:'play_toggle'})}logPause(t){this.log({operation:'pause',param:String(Math.round(t.position))})}logSeek(){this.log({operation:'seek'})}logFirstBytes(t){this.log({operation:'first_bytes',param:String(t.time)})}logFirstFrame(t){this.log({operation:'first_frame',param:String(t.time)})}logError(t){this.log({operation:'error',param:t.errorType})}logWatchCoverageRecord(t){this.log({operation:'watch_coverage_record',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logWatchCoverageLive(t){this.log({operation:'watch_coverage_live',param:`${t.start}-${t.end}`}),this.logger.flush(!0)}logEmptyBuffer(t){this.log({operation:'empty_buffer',param:String(t.duration)})}logDownloadSpeed(t){this.log({operation:'download_speed',param:String(t.speed)})}logAdSlotRequest(){this.log({operation:'adv',param:'slot_request'})}logAdStarted(t){this.log({operation:'adv',param:t})}logAdPaused(){this.log({operation:'adv',param:'pause'})}logAdResumed(){this.log({operation:'adv',param:'resume'})}logAdEnded(){this.log({operation:'adv',param:'ended'})}logAdSkipped(){this.log({operation:'adv',param:'skip'})}logAdClicked(){this.log({operation:'adv',param:'click'})}log(t){const e=this.crateLogItem(t);this.logger.log(e)}crateLogItem({operation:t,param:e}){const r=Date.now(),n={vid:this.statContext.movieId,quality:this.statContext.quality,dst:this.statContext.destination,ct:this.statContext.contentType,aid:this.statContext.albumId,place:this.statContext.place,cdn_host:this.statContext.cdnHostname,connection_type:this.statContext.connectionType,connection_reused:!0===this.statContext.connectionReused?Ua.YES:!1===this.statContext.connectionReused?Ua.NO:void 0,stat_type:!0===this.statContext.autoplay?La.AUTO:!1===this.statContext.autoplay?La.MANUAL:void 0,vk_playlist_id:this.statContext.vkPlaylistId,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode};return void 0!==e&&(n.param=e),{operation:t,timestamp:r,custom:n}}};

/**
 * @vkontakte/videoplayer-shared v1.0.17
 * Thu, 01 Sep 2022 13:39:40 GMT
 * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-17/doc/
 */
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});class t{subscriptions=[];unsubscribe(){const t=this.subscriptions;this.subscriptions=[],t.forEach((t=>'function'==typeof t?t():t.unsubscribe()))}add(t){return this.subscriptions.push(t),this}}const e=t=>{throw new Error(`${t} is value of unexpected type`)},r=()=>{};class s{constructor(t){t&&(this._subscribe=t)}subscribe(s,n){let i;i=n?'function'==typeof n?{next:n,error:r}:{next:t=>n.next(t),error:t=>n.error?.(t)}:{next:r,error:r};const o='function'==typeof s?{next:t=>{try{s(t)}catch(t){i.next(t)}},error:t=>i.next(t)}:{next:t=>s.next(t),error:t=>s.error?s.error(t):i.next(t)};let a;try{a=this._subscribe(o)}catch(t){o.error?.(t)}return(new t).add((()=>{switch(o.next=r,o.error=r,typeof a){case'function':return void a();case'object':return void a.unsubscribe();case'undefined':return;default:return e(a)}}))}pipe(...t){return t.reduce(((t,e)=>e(t)),this)}_subscribe(t){}}class n extends s{keyCounter=0;subscribers=new Map;constructor(){super()}next(t){this.subscribers.forEach((e=>e.next(t)))}error(t){this.subscribers.forEach((e=>e.error?.(t)))}_subscribe(e){const r=this.keyCounter++;return this.subscribers.set(r,e),(new t).add((()=>this.subscribers.delete(r)))}}function i(t){return null!=t}function o(t){return null==t}const a='function'==typeof window.performance?.now?()=>window.performance.now():()=>Date.now();const c={leading:!1,trailing:!0};class u{destination;time;config;lastValue;timeout;constructor(t,e,r){this.destination=t,this.time=e,this.config=r}next(t){this.lastValue=t,i(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(t),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(t){if(!this.destination.error)throw t;this.destination.error(t)}this.timeout=void 0}),this.time)}error(t){this.destination.error?.(t)}}const l={leading:!0,trailing:!1};class h{destination;time;config;lastValue;timeout;constructor(t,e,r){this.destination=t,this.time=e,this.config=r}next(t){this.lastValue=t,o(this.timeout)&&(this.config.leading&&this.destination.next(t),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(t){this.destination.error?.(t)}}class d{destination;predicate;constructor(t,e){this.destination=t,this.predicate=e}next(t){let e;try{e=this.predicate(t)}catch(t){throw this.error(t),t}e&&this.destination.next(t)}error(t){this.destination.error?.(t)}}const b={};class p{destination;predicate;lastValue=b;constructor(t,e){this.destination=t,this.predicate=e}next(t){let e;try{e=this.lastValue===b||!this.predicate(this.lastValue,t),this.lastValue=t}catch(t){throw this.error(t),t}e&&this.destination.next(t)}error(t){this.destination.error?.(t)}}function x(t){return e=>new s((r=>e.subscribe(new w(r,t))))}class w{destination;mapper;constructor(t,e){this.destination=t,this.mapper=e}next(t){let e;try{e=this.mapper(t)}catch(t){throw this.error(t),t}this.destination.next(e)}error(t){this.destination.error?.(t)}}class f{destination;last;hasLast=!1;constructor(t){this.destination=t}next(t){const e=this.last;this.last=t,this.hasLast?this.destination.next([e,t]):this.hasLast=!0}error(t){this.destination.error?.(t)}}class m{destination;effect;constructor(t,e){this.destination=t,this.effect=e}next(t){try{this.effect(t)}catch(t){throw this.error(t),t}this.destination.next(t)}error(t){this.destination.error?.(t)}}exports.Logger=class{log$=new n;logs=[];log=t=>{const e={...t,timestamp:Date.now()};this.logs.push(e),this.log$.next(e)};createCustomLog(t){return(...e)=>{let r;try{r=t(...e)}catch{r={message:'error in `createCustomLog`',component:'Logger'}}this.log(r)}}createComponentLog(t){return this.createCustomLog((e=>({component:t,...e})))}getAllLogs=()=>this.logs},exports.Observable=s,exports.Subject=n,exports.Subscription=t,exports.ValueSubject=class extends n{value;constructor(t){super(),this.value=t}next(t){super.next(this.value=t)}error(t){super.error(this.value=t)}getValue(){return this.value}_subscribe(t){const e=super._subscribe(t);return t.next(this.value),e}},exports.abortable=(t,e)=>async(...r)=>{const s=e(...r);let n,i=t.aborted;for(;!i&&!t.aborted;){const t=await s.next(n);i=t.done??!1,n=t.value}return n},exports.addScript=(t,e,r)=>new Promise(((s,n)=>{e.addEventListener('abort',(()=>{a(),u.remove()}));const i=()=>{a(),n()},o=()=>{a(),s()},a=()=>{c&&clearTimeout(c),u.removeEventListener('load',o),u.removeEventListener('error',i)};let c;r&&(c=window.setTimeout(i,r));const u=document.createElement('script');u.addEventListener('load',o),u.addEventListener('error',i),u.src=t,document.head.appendChild(u)})),exports.assertNever=e,exports.assertNonNullable=function(t,e='Assertion "value is not nullable" failed'){if(null==t)throw new Error(e)},exports.assertNullable=function(t,e='Assertion "value is nullable" failed'){if(null!=t)throw new Error(e)},exports.checkNever=t=>{},exports.combine=function(e){return new s((r=>{const s={};let n=Object.keys(e).length;return Object.entries(e).reduce(((t,[e,i])=>t.add(i.subscribe((t=>e=>{t in s||n--,s[t]=e,0===n&&r.next(s)})(e)))),new t)}))},exports.debounce=function(t,e=c){return r=>new s((s=>r.subscribe(new u(s,t,e))))},exports.filter=function(t){return e=>new s((r=>e.subscribe(new d(r,t))))},exports.filterChanged=function(t=((t,e)=>t===e)){return e=>new s((r=>e.subscribe(new p(r,t))))},exports.fromEvent=(t,e)=>new s((r=>{const s=t=>r.next(t);return t.addEventListener(e,s),()=>t.removeEventListener(e,s)})),exports.getExponentialDelay=(t,{start:e=0,factor:r=2,max:s=1/0,min:n=e,random:i=0}={})=>{let o=e;return o*=r**t,o*=Math.random()*i*2-i+1,o=Math.round(o),o=Math.min(o,s),o=Math.max(o,n),o},exports.interval=t=>new s((e=>{const r=window.setInterval((()=>e.next()),t);return()=>window.clearInterval(r)})),exports.isNonNullable=i,exports.isNullable=o,exports.map=x,exports.mapTo=function(t){return x((()=>t))},exports.merge=function(...e){return new s((r=>e.reduce(((t,e)=>t.add(e.subscribe(r))),new t)))},exports.noop=r,exports.now=a,exports.observableFrom=t=>new s((e=>{t.forEach((t=>e.next(t)))})),exports.once=function(){return t=>new s((e=>{let r=!1,s=!1;const n=t.subscribe((t=>{r||(r=!0,e.next(t)),s&&n.unsubscribe()}),(t=>{r=!0,e.error?.(t),s&&n.unsubscribe()}));return s=!0,r&&n.unsubscribe(),n}))},exports.pairwise=function(){return t=>new s((e=>t.subscribe(new f(e))))},exports.tap=function(t){return e=>new s((r=>e.subscribe(new m(r,t))))},exports.throttle=function(t,e=l){return r=>new s((s=>r.subscribe(new h(s,t,e))))},exports.timeout=t=>new s((e=>{const r=window.setTimeout((()=>{try{e.next()}catch(t){if(!e.error)throw t;e.error(t)}}),t);return()=>window.clearTimeout(r)}));

/**
 * @vkontakte/videoplayer-shared v1.0.17
 * Thu, 01 Sep 2022 13:39:40 GMT
 * https://st.mycdn.me/static/vkontakte-videoplayer/1-0-17/doc/
 */
class t{subscriptions=[];unsubscribe(){const t=this.subscriptions;this.subscriptions=[],t.forEach((t=>'function'==typeof t?t():t.unsubscribe()))}add(t){return this.subscriptions.push(t),this}}const e=t=>{throw new Error(`${t} is value of unexpected type`)},r=t=>{},n=()=>{};class s{constructor(t){t&&(this._subscribe=t)}subscribe(r,s){let i;i=s?'function'==typeof s?{next:s,error:n}:{next:t=>s.next(t),error:t=>s.error?.(t)}:{next:n,error:n};const o='function'==typeof r?{next:t=>{try{r(t)}catch(t){i.next(t)}},error:t=>i.next(t)}:{next:t=>r.next(t),error:t=>r.error?r.error(t):i.next(t)};let c;try{c=this._subscribe(o)}catch(t){o.error?.(t)}return(new t).add((()=>{switch(o.next=n,o.error=n,typeof c){case'function':return void c();case'object':return void c.unsubscribe();case'undefined':return;default:return e(c)}}))}pipe(...t){return t.reduce(((t,e)=>e(t)),this)}_subscribe(t){}}class i extends s{keyCounter=0;subscribers=new Map;constructor(){super()}next(t){this.subscribers.forEach((e=>e.next(t)))}error(t){this.subscribers.forEach((e=>e.error?.(t)))}_subscribe(e){const r=this.keyCounter++;return this.subscribers.set(r,e),(new t).add((()=>this.subscribers.delete(r)))}}class o{log$=new i;logs=[];log=t=>{const e={...t,timestamp:Date.now()};this.logs.push(e),this.log$.next(e)};createCustomLog(t){return(...e)=>{let r;try{r=t(...e)}catch{r={message:'error in `createCustomLog`',component:'Logger'}}this.log(r)}}createComponentLog(t){return this.createCustomLog((e=>({component:t,...e})))}getAllLogs=()=>this.logs}function c(t,e='Assertion "value is not nullable" failed'){if(null==t)throw new Error(e)}function a(t,e='Assertion "value is nullable" failed'){if(null!=t)throw new Error(e)}function u(t){return null!=t}function h(t){return null==t}const l=(t,e,r)=>new Promise(((n,s)=>{e.addEventListener('abort',(()=>{c(),u.remove()}));const i=()=>{c(),s()},o=()=>{c(),n()},c=()=>{a&&clearTimeout(a),u.removeEventListener('load',o),u.removeEventListener('error',i)};let a;r&&(a=window.setTimeout(i,r));const u=document.createElement('script');u.addEventListener('load',o),u.addEventListener('error',i),u.src=t,document.head.appendChild(u)})),d='function'==typeof window.performance?.now?()=>window.performance.now():()=>Date.now(),b=(t,e)=>async(...r)=>{const n=e(...r);let s,i=t.aborted;for(;!i&&!t.aborted;){const t=await n.next(s);i=t.done??!1,s=t.value}return s},w=(t,{start:e=0,factor:r=2,max:n=1/0,min:s=e,random:i=0}={})=>{let o=e;return o*=r**t,o*=Math.random()*i*2-i+1,o=Math.round(o),o=Math.min(o,n),o=Math.max(o,s),o};class f extends i{value;constructor(t){super(),this.value=t}next(t){super.next(this.value=t)}error(t){super.error(this.value=t)}getValue(){return this.value}_subscribe(t){const e=super._subscribe(t);return t.next(this.value),e}}function m(e){return new s((r=>{const n={};let s=Object.keys(e).length;return Object.entries(e).reduce(((t,[e,i])=>t.add(i.subscribe((t=>e=>{t in n||s--,n[t]=e,0===s&&r.next(n)})(e)))),new t)}))}function x(...e){return new s((r=>e.reduce(((t,e)=>t.add(e.subscribe(r))),new t)))}var p=t=>new s((e=>{const r=window.setTimeout((()=>{try{e.next()}catch(t){if(!e.error)throw t;e.error(t)}}),t);return()=>window.clearTimeout(r)})),g=t=>new s((e=>{const r=window.setInterval((()=>e.next()),t);return()=>window.clearInterval(r)})),v=t=>new s((e=>{t.forEach((t=>e.next(t)))})),y=(t,e)=>new s((r=>{const n=t=>r.next(t);return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}));const L={leading:!1,trailing:!0};function E(t,e=L){return r=>new s((n=>r.subscribe(new V(n,t,e))))}class V{destination;time;config;lastValue;timeout;constructor(t,e,r){this.destination=t,this.time=e,this.config=r}next(t){this.lastValue=t,u(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(t),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(t){if(!this.destination.error)throw t;this.destination.error(t)}this.timeout=void 0}),this.time)}error(t){this.destination.error?.(t)}}const C={leading:!0,trailing:!1};function T(t,e=C){return r=>new s((n=>r.subscribe(new _(n,t,e))))}class _{destination;time;config;lastValue;timeout;constructor(t,e,r){this.destination=t,this.time=e,this.config=r}next(t){this.lastValue=t,h(this.timeout)&&(this.config.leading&&this.destination.next(t),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(t){this.destination.error?.(t)}}function M(t){return e=>new s((r=>e.subscribe(new j(r,t))))}class j{destination;predicate;constructor(t,e){this.destination=t,this.predicate=e}next(t){let e;try{e=this.predicate(t)}catch(t){throw this.error(t),t}e&&this.destination.next(t)}error(t){this.destination.error?.(t)}}function k(t=((t,e)=>t===e)){return e=>new s((r=>e.subscribe(new $(r,t))))}const A={};class ${destination;predicate;lastValue=A;constructor(t,e){this.destination=t,this.predicate=e}next(t){let e;try{e=this.lastValue===A||!this.predicate(this.lastValue,t),this.lastValue=t}catch(t){throw this.error(t),t}e&&this.destination.next(t)}error(t){this.destination.error?.(t)}}function D(t){return e=>new s((r=>e.subscribe(new I(r,t))))}class I{destination;mapper;constructor(t,e){this.destination=t,this.mapper=e}next(t){let e;try{e=this.mapper(t)}catch(t){throw this.error(t),t}this.destination.next(e)}error(t){this.destination.error?.(t)}}function O(t){return D((()=>t))}function P(){return t=>new s((e=>{let r=!1,n=!1;const s=t.subscribe((t=>{r||(r=!0,e.next(t)),n&&s.unsubscribe()}),(t=>{r=!0,e.error?.(t),n&&s.unsubscribe()}));return n=!0,r&&s.unsubscribe(),s}))}function q(){return t=>new s((e=>t.subscribe(new z(e))))}class z{destination;last;hasLast=!1;constructor(t){this.destination=t}next(t){const e=this.last;this.last=t,this.hasLast?this.destination.next([e,t]):this.hasLast=!0}error(t){this.destination.error?.(t)}}function B(t){return e=>new s((r=>e.subscribe(new F(r,t))))}class F{destination;effect;constructor(t,e){this.destination=t,this.effect=e}next(t){try{this.effect(t)}catch(t){throw this.error(t),t}this.destination.next(t)}error(t){this.destination.error?.(t)}}export{o as Logger,s as Observable,i as Subject,t as Subscription,f as ValueSubject,b as abortable,l as addScript,e as assertNever,c as assertNonNullable,a as assertNullable,r as checkNever,m as combine,E as debounce,M as filter,k as filterChanged,y as fromEvent,w as getExponentialDelay,g as interval,u as isNonNullable,h as isNullable,D as map,O as mapTo,x as merge,n as noop,d as now,v as observableFrom,P as once,q as pairwise,B as tap,T as throttle,p as timeout};

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],p=0,a=i.length;p<a;p++,o++)r[o]=i[p];return r}function createCounter(){return{current:0,next:function(){return++this.current}}}function createRequestResolver(){var r=createCounter(),o={};return{add:function(e,t){var n=null!=t?t:r.next();return o[n]=e,n},resolve:function(e,t,n){var r=o[e];r&&(n(t)?r.resolve(t):r.reject(t),o[e]=null)}}}function promisifySend(i,e){var p=createRequestResolver();return e(function(e){if(e.detail&&e.detail.data&&"object"==typeof e.detail.data&&"request_id"in e.detail.data){var t=e.detail.data,n=t.request_id,r=__rest(t,["request_id"]);n&&p.resolve(n,r,function(e){return!("error_type"in e)})}}),function(r,o){return void 0===o&&(o={}),new Promise(function(e,t){var n=p.add({resolve:e,reject:t},o.request_id);i(r,__assign(__assign({},o),{request_id:n}))})}}var webSdkHandlers,IS_CLIENT_SIDE="undefined"!=typeof window,IS_ANDROID_WEBVIEW=Boolean(IS_CLIENT_SIDE&&window.AndroidBridge),IS_IOS_WEBVIEW=Boolean(IS_CLIENT_SIDE&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.VKWebAppClose),IS_REACT_NATIVE_WEBVIEW=Boolean(IS_CLIENT_SIDE&&window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage),IS_WEB=IS_CLIENT_SIDE&&!IS_ANDROID_WEBVIEW&&!IS_IOS_WEBVIEW,IS_MVK=IS_WEB&&/(^\?|&)vk_platform=mobile_web(&|$)/.test(location.search),IS_DESKTOP_VK=IS_WEB&&!IS_MVK,EVENT_TYPE=IS_WEB?"message":"VKWebAppEvent",DESKTOP_METHODS=__spreadArrays(["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppAddToHomeScreenInfo","VKWebAppClose","VKWebAppCopyText","VKWebAppCreateHash","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppSendToClient","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGroupInfo","VKWebAppGetGeodata","VKWebAppGetCommunityToken","VKWebAppGetConfig","VKWebAppGetLaunchParams","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppLeaveGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites","VKWebAppShowCommunityWidgetPreviewBox","VKWebAppShowStoryBox","VKWebAppStorageGet","VKWebAppStorageGetKeys","VKWebAppStorageSet","VKWebAppFlashGetInfo","VKWebAppSubscribeStoryApp","VKWebAppOpenWallPost","VKWebAppCheckAllowedScopes","VKWebAppCheckNativeAds","VKWebAppShowNativeAds","VKWebAppRetargetingPixel","VKWebAppConversionHit","VKWebAppShowSubscriptionBox","VKWebAppCheckSurvey","VKWebAppShowSurvey","VKWebAppScrollTop","VKWebAppScrollTopStart","VKWebAppScrollTopStop"],IS_DESKTOP_VK?["VKWebAppResizeWindow","VKWebAppAddToMenu","VKWebAppShowInstallPushBox","VKWebAppGetFriends"]:["VKWebAppShowImages"]),androidBridge=IS_CLIENT_SIDE?window.AndroidBridge:void 0,iosBridge=IS_IOS_WEBVIEW?window.webkit.messageHandlers:void 0,webBridge=IS_WEB?parent:void 0;function createVKBridge(n){var i=void 0,p=[];function e(e){p.push(e)}function t(){return IS_IOS_WEBVIEW||IS_ANDROID_WEBVIEW}function r(){return IS_WEB&&window.parent!==window}function o(){return t()||r()}function a(t){if(IS_IOS_WEBVIEW||IS_ANDROID_WEBVIEW)return __spreadArrays(p).map(function(e){return e.call(null,t)});var e=null==t?void 0:t.data;if(IS_WEB&&e){if(IS_REACT_NATIVE_WEBVIEW&&"string"==typeof e)try{e=JSON.parse(e)}catch(e){}var n=e.type,r=e.data,o=e.frameId;n&&("SetSupportedHandlers"!==n?"VKWebAppSettings"!==n?__spreadArrays(p).map(function(e){return e({detail:{type:n,data:r}})}):i=o:webSdkHandlers=r.supportedHandlers)}}IS_REACT_NATIVE_WEBVIEW&&/(android)/i.test(navigator.userAgent)?document.addEventListener(EVENT_TYPE,a):"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener(EVENT_TYPE,a);var s=promisifySend(function(e,t){androidBridge&&androidBridge[e]?androidBridge[e](JSON.stringify(t)):iosBridge&&iosBridge[e]&&"function"==typeof iosBridge[e].postMessage?iosBridge[e].postMessage(t):IS_REACT_NATIVE_WEBVIEW?window.ReactNativeWebView.postMessage(JSON.stringify({handler:e,params:t})):webBridge&&"function"==typeof webBridge.postMessage&&webBridge.postMessage({handler:e,params:t,type:"vk-connect",webFrameId:i,connectVersion:n},"*")},e);return{send:s,sendPromise:s,subscribe:e,unsubscribe:function(e){var t=p.indexOf(e);-1<t&&p.splice(t,1)},supports:function(e){return IS_ANDROID_WEBVIEW?!(!androidBridge||"function"!=typeof androidBridge[e]):IS_IOS_WEBVIEW?!(!iosBridge||!iosBridge[e]||"function"!=typeof iosBridge[e].postMessage):!!IS_WEB&&-1<DESKTOP_METHODS.indexOf(e)},isWebView:t,isIframe:r,isEmbedded:o,isStandalone:function(){return!o()}}}function createCustomEventPolyfill(){function e(e,t){var n=t||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!!n.bubbles,!!n.cancelable,n.detail),r}return e.prototype=Event.prototype,e}var version="2.7.0";function applyMiddleware(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.includes(void 0)||r.includes(null)?applyMiddleware.apply(void 0,r.filter(function(e){return"function"==typeof e})):function(n){if(0===r.length)return n;var e,t={subscribe:n.subscribe,send:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.send.apply(n,e)}};return e=r.filter(function(e){return"function"==typeof e}).map(function(e){return e(t)}).reduce(function(t,n){return function(e){return t(n(e))}})(n.send),__assign(__assign({},n),{send:e})}}!function(e){e.REWARD="reward",e.INTERSTITIAL="interstitial"}(exports.EAdsFormats||(exports.EAdsFormats={})),function(e){e.CAMERA="camera",e.LOCATION="location",e.PHOTO="photo"}(exports.EGrantedPermission||(exports.EGrantedPermission={})),function(e){e.RU="ru",e.UK="uk",e.UA="ua",e.EN="en",e.BE="be",e.KZ="kz",e.PT="pt",e.ES="es"}(exports.EGetLaunchParamsResponseLanguages||(exports.EGetLaunchParamsResponseLanguages={})),function(e){e.ADMIN="admin",e.EDITOR="editor",e.MEMBER="member",e.MODER="moder",e.NONE="none"}(exports.EGetLaunchParamsResponseGroupRole||(exports.EGetLaunchParamsResponseGroupRole={})),function(e){e.DESKTOP_WEB="desktop_web",e.MOBILE_WEB="mobile_web",e.MOBILE_ANDROID="mobile_android",e.MOBILE_ANDROID_MESSENGER="mobile_android_messenger",e.MOBILE_IPHONE="mobile_iphone",e.MOBILE_IPHONE_MESSENGER="mobile_iphone_messenger",e.MOBILE_IPAD="mobile_ipad"}(exports.EGetLaunchParamsResponsePlatforms||(exports.EGetLaunchParamsResponsePlatforms={})),"undefined"==typeof window||window.CustomEvent||(window.CustomEvent=createCustomEventPolyfill());var bridge=createVKBridge(version);exports.applyMiddleware=applyMiddleware,exports.default=bridge;
//# sourceMappingURL=index.js.map
